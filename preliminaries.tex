%%!TEX root = invitation.tex
\chapter{Preliminaries}

In this chapter we fix some conventions and remind the main definitions.
%We suggest to skip this chapter and use it as a quick reference while reading the rest. !!! I don't like telling the reader to skip something altogether. Not sure how to rephrase this !!!

To learn the background in metric geometry, the reader advised to read the book of Burgos and Ivanov \cite{BBI}.
 

\section{Metric spaces}
\label{sec:metric spaces}


The distance between two points $x$ and $y$ in a metric space $\spc{X}$ will be denoted by $\dist{x}{y}{}$ or $\dist{x}{y}{\spc{X}}$.
The latter notation is used if we need to emphasize 
that the distance is taken in the space ${\spc{X}}$.

The function 
\[\dist{x}{}{}\:y\mapsto \dist{x}{y}{}\]
is called the \emph{distance function}\index{distance function} from $x$. 

\begin{itemize}
\item The \emph{diameter}\index{Diameter} of metric space $\spc{X}$ is defined as
\[\diam \spc{X}=\sup\set{\dist{x}{y}{\spc{X}}}{x,y\in \spc{X}}.\]

\item Given $R\in[0,\infty]$ and $x\in \spc{X}$, the sets
\begin{align*}
\oBall(x,R)&=\{y\in \spc{X}\mid \dist{x}{y}{}<R\},
\\
\cBall[x,R]&=\{y\in \spc{X}\mid \dist{x}{y}{}\le R\}
\end{align*}
are called respectively the  \emph{open}\index{open ball} and  the \emph{closed  balls}\index{closed ball}   of radius $R$ with center $x$.
Again, if we need to emphasize that these balls are taken in the metric space $\spc{X}$,
we write 
\[\oBall(x,R)_{\spc{X}}\quad\text{and}\quad\cBall[x,R]_{\spc{X}}\]
correspondingly.
\end{itemize}

A metric space $\spc{X}$ is called \emph{proper}\index{proper space} if all closed bounded sets in $\spc{X}$ are compact. 
This condition is equivalent to each of the following statements:
\begin{enumerate}
\item For some (and therefore any) point $p\in \spc{X}$ and any $R<\infty$, 
the closed ball $\cBall[p,R]\subset\spc{X}$ is compact. 
\item The function $\dist{p}{}{}\:\spc{X}\to\RR$ is proper for some (and therefore any) point $p\in \spc{X}$;
that is, for any compact set $K\subset \RR$, its inverse image 
$\set{x\in \spc{X}}{\dist{p}{x}{\spc{X}}\in K}$
is compact.
\end{enumerate}

\section{Constructions}\label{sec:constructions}

\parbf{Product space.}
Given two metric spaces $\spc{U}$ and $\spc{V}$, the \emph{product space} 
$\spc{U}\times\spc{V}$ is defined as the set of all pairs $(u,v)$ in the set $\spc{U}\times\spc{V}$ 
with the metric defined by formulas
\[\dist{(u^1,v^1)}{(u^2,v^2)}{\spc{U}\times\spc{V}}=\sqrt{\dist[2]{u^1}{u^2}{\spc{U}}+\dist[2]{v^1}{v^2}{\spc{V}}}.\]


\parbf{Cone.}
The \emph{cone} $\spc{V}=\Cone\spc{U}$ over metric space $\spc{U}$
is defined as the metric space with the underlying set formed by the equivalence classes in
$[0,\infty)\times \spc{U}$ with the equivalence relation ``$\sim$'' such that $(0,p)\sim (0,q)$ for any points $p,q\in\spc{U}$
and the metric is given by the cosine rule
\[
\dist{(p,s)}{(q,t)}{\spc{V}} 
=
\sqrt{s^2+t^2-2\cdot s\cdot t\cdot \cos\alpha},
\]
where $\alpha= \max\{\pi, \dist{p}{q}{\spc{U}}\}$.

The point in the cone $\spc{V}$ formed by the equivalence class of $0\times\spc{U}$ is called the \emph{tip of the cone} and is denoted by $0$ or $0_{\spc{V}}$.
The distance $\dist{0}{v}{\spc{V}}$ is called the norm of $v$ and is denoted as $|v|$ or $|v|_{\spc{V}}$.

\parbf{Suspension.}
The \emph{suspension} $\spc{V}=\Susp\spc{U}$ over metric space $\spc{U}$
is defined as the metric space with underlying set formed by the equivalence classes on
$[0,\infty]\times \spc{U}$ with the equivalence relation ``$\sim$'' defined by $(0,p)\sim (0,q)$ and $(\pi,p)\sim (\pi,q)$ for any points $p,q\in\spc{U}$
and the metric given by spherical cosine rule
\[
\cos\dist{(p,s)}{(q,t)}{\Susp\spc{U}} 
=
\cos s\cdot\cot t-\sin s\cdot\sin t\cdot\cos\alpha,
\]
where $\alpha= \max\{\pi, \dist{p}{q}{\spc{U}}\}$.

The points in $\spc{V}$ formed by the equivalence class of $0\times\spc{U}$ and $\pi\times\spc{U}$ are called  the \emph{north} and the  \emph{south pole} of the suspension.

\begin{thm}{Exercise}\label{ex:product-cone}
Let $\spc{U}$ be a metric space.
Show that the spaces 
\[\RR\times \Cone\spc{U}\quad\text{and}\quad\Cone[\Susp\spc{U}]\]
are  isometric.
\end{thm}




\section{Geodesics, triangles and hinges}
\label{sec:geods}

\parbf{Geodesics.}
Let $\spc{X}$ be a metric space 
and $\II$\index{$\II$} be a real interval. 
A globally isometric map $\gamma\:\II\to \spc{X}$ is called a \emph{geodesic}\index{geodesic}%
\footnote{Various authors call it differently: \emph{shortest path}, \emph{minimizing geodesic}.}; 
in other words, $\gamma\:\II\to \spc{X}$ is a geodesic if 
\[\dist{\gamma(s)}{\gamma(t)}{\spc{X}}=|s-t|\]
for any pair $s,t\in \II$.

We say that  $\gamma\:\II\to \spc{X}$ is a geodesic from point $p$ to point $q$ if $\gamma$ is a geodesic and 
$\II=[a,b]$ and $p=\gamma(a)$, $q=\gamma(b)$. 
In this case the image of $\gamma$ is denoted by $[p q]$\index{$[{*}{*}]$} and with an abuse of notations  we also call it a \emph{geodesic}\index{geodesic}.
Given a geodesic $[pq]$ we can parametrize it by distance to $p$;
this parametrization will be denoted as $\geod_{[p q]}(t)$.
Clearly $\geod_{[p q]}(t)$ is a geodesic in the sense of the first definition.

We may write $[p q]_{\spc{X}}$ 
to emphasize that the geodesic $[p q]$ is in the space  ${\spc{X}}$.
Also we use the following short-cut notation:
\begin{align*}
\l] p q \r[&=[pq]\backslash\{p,q\},
&
\l] p q \r]&=[pq]\backslash\{p\},
&
\l[ p q \r[&=[pq]\backslash\{q\}.
\end{align*}



In general, a geodesic between $p$ and $q$ need not exist and if it exists, it need not  be unique.  However,  once we write $[p q]$ we mean that we made a choice of geodesic.

A metric space is called \emph{geodesic}\index{geodesic} if any pair of its points can be joined by a geodesic. 

A constant-speed reparameterization of a geodesic by $[0,1]$ is called a \emph{geodesic path}\index{geodesic path}.
Given a geodesic $[p q]$,
we denote by $\geodpath_{[pq]}$ the corresponding geodesic path;
that is,
$$\geodpath_{[pq]}(t)\z\equiv\geod_{[pq]}(t\cdot\dist[{{}}]{p}{q}{}).$$

A curve $\gamma\:\II\to \spc{X}$  is called a \emph{local geodesic}\index{geodesic!local geodesic}, if for any $t\in\II$ there is a neighborhood $U$ of $t$ in $\II$ such that the restriction $\gamma|_U$ is a  geodesic. 


\parbf{Triangles.}
For a triple of points $p,q,r\in \spc{X}$, a choice of a triple of geodesics $([q r], [r p], [p q])$ will be called a \emph{triangle}\index{triangle} and we will use the short notation 
$\trig p q r=([q r], [r p], [p q])$\index{$\trig {{*}}{{*}}{{*}}$}.
Again, given a triple $p,q,r\in \spc{X}$ there may be no triangle 
$\trig p q r$ simply because one of the pairs of these points can not be joined by a geodesic, and also many different triangles with these vertexes may exist, any of which can be denoted by $\trig p q r$.
Once we write $\trig p q r$, it means that we made a choice of such a triangle, 
that is, a choice of each $[q r], [r p]$ and $[p q]$.
The value $\dist{p}{q}{}+\dist{q}{r}{}+\dist{r}{p}{}$ will be called the \emph{perimeter of the triangle} $\trig p q r$.

\parbf{Hinges.}
Let $p,x,y\in \spc{X}$ be a triple of points such that $p$ is distinct from $x$ and $y$.
A pair of geodesics $([p x],[p y])$ will be called  a \emph{hinge}\index{hinge} and it will be denoted by 
$\hinge p x y=([p x],[p y])$\index{$\hinge{{*}}{{*}}{{*}}$}.


\parbf{Convex sets.}\label{def:convex-set}
Let $\spc{X}$ be a metric space. 
A set $A\subset\spc{X}$ is called 
\emph{convex}%
\index{convex set}
if for every two points $p,q\in A$, 
\emph{every} geodesic $[pq]$ of $\spc{X}$ 
lies in $A$.

A set $A\subset\spc{X}$ is called 
\emph{locally convex}
if every point $a\in A$ admits an open neighborhood $\Omega\ni a$
such that any geodesic lying in $\Omega$ and with ends in $A$ lies completely in $A$.


Note that any open set is locally convex by definition.

\section{Length spaces}\label{sec:intrinsic}

Recall that a path or a  curve is a continuous map from a real interval to a space.

\begin{thm}{Definition}
Let $\spc{X}$ be a metric space and
$\alpha\: \II\to \spc{X}$ be a curve.
We define the \emph{length}\index{length} of $\alpha$ as 
\[
\length \alpha \df \sup_{t_0\le t_1\le\ldots\le t_n}\sum_i \dist{\alpha(t_i)}{\alpha_{i+1}}{}
\]
\end{thm}

Directly from the definition, it follows that if a path $\alpha$ is connecting two points $x$ and $y$ \footnote{That is, such that $\alpha(0)=x$ and $\alpha(1)=y$.} then 
\[\length\alpha\ge \dist{x}{y}{}.\]

If for any $\eps>0$ and any pair of points $x$ and $y$ in a metric space $\spc{X}$ there is a path $\alpha$ connecting $x$ to $y$ such that
\[\length\alpha< \dist{x}{y}{}+\eps\]
then $\spc{X}$ is called a \emph{length space}.

Note that any geodesic space is a length space;
as can be seen from the following example, the converse does not hold.


\begin{thm}{Example}
Let $\spc{X}$ be obtained by gluing a countable collection of disjoint intervals $I_i$ of length $1+1/i$ where for each $I_i$ one end is glued to $p=\{0\}$ and the other to $q=\{1\}$.
Then $\spc{X}$ carries a natural complete length metric  with respect to which $\dist{p}{q}{}=1$ but there is no geodesic connecting $p$ to $q$.
\end{thm}



\begin{thm}{Exercise}\label{ex:no-geod}
Give an example of a complete length space for which no pair of distinct points can be joined by a geodesic.
\end{thm}

Let $\spc{X}$ be a metric space and $x,y\in\spc{X}$.

\begin{enumerate}[(i)]
\item A point $z\in \spc{X}$ is called a \emph{midpoint} between $x$ and $y$
if 
\[\dist{x}{z}{}=\dist{y}{z}{}=\tfrac12\cdot\dist[{{}}]{x}{y}{}.\]
\item Assume $\eps\ge 0$.
A point $z\in \spc{X}$ is called an \emph{$\eps$-midpoint} between $x$ and $y$
if 
\[\dist{x}{z}{},\dist{y}{z}{}<\tfrac12\cdot\dist[{{}}]{x}{y}{}+\eps.\]
\end{enumerate}


Note that a $0$-midpoint is the same as a midpoint.


\begin{thm}{Lemma}\label{lem:mid>geod}
Let $\spc{X}$ be a complete metric space.
\begin{subthm}{lem:mid>length}
Assume that for any pair of points $x,y\in \spc{X}$  
 and any $\eps>0$
there is a $\eps$-midpoint $z$.
Then $\spc{X}$ is a length space.
\end{subthm}

\begin{subthm}{lem:mid>geod:geod}
Assume that for any pair of points $x,y\in \spc{X}$ 
there is a midpoint $z$.
Then $\spc{X}$ is a geodesic space.
\end{subthm}
\end{thm}

\parit{Proof.}
We first prove (\ref{SHORT.lem:mid>length}).
Let $x,y\in \spc{X}$ be a pair of points.

Set $\eps_n=\frac\eps{2^{2\cdot n}}$.

Set $\alpha(0)=x$ and $\alpha(1)=y$.

Set $\alpha(\tfrac12)$ to be an $\eps_1$-midpoint of $\alpha(0)$ and $\alpha(1)$.
Further, set $\alpha(\frac14)$ 
and $\alpha(\frac34)$ to be $\eps_2$-midpoints 
for the pairs $(\alpha(0),\alpha(\tfrac12)$ 
and $(\alpha(\tfrac12),\alpha(1)$ respectively.
Applying the above procedure recursively,
on the $n$-th step we define $\alpha(\tfrac{\kay}{2^n})$
for every odd integer $\kay$ such that $0<\tfrac\kay{2^n}<1$, 
as an $\eps_{n}$-midpoint of the already defined
$\alpha(\tfrac{\kay-1}{2^n})$ and $\alpha(\tfrac{\kay+1}{2^n})$.


In this way we define $\alpha(t)$ for $t\in W$,
where $W$ denotes the set of dyadic rationals in $[0,1]$.
For any $t\in[0,1]$ consider a sequence of $t_n\in W$ such that $t_n\to t$ as $n\to\infty$.
Note that the sequence $\alpha(t_n)$ is Cauchy and hence it converges;
define $\alpha(t)$ as its limit.
It is easy to see that $\alpha(t)$
does not depend on the choice of the sequence $t_n$
and $\alpha\:[0,1]\to\spc{X}$ is a path from $x$ to $y$.
Moreover,
\[\begin{aligned}
\length\alpha&\le \dist{x}{y}{}+\sum_{n=1}^\infty 2^{n-1}\cdot\eps_n\le
\\
&\le \dist{x}{y}{}+\tfrac\eps2.
\end{aligned}
\eqlbl{eq:eps-midpoint}
\]
Since $\eps>0$ is arbitrary, we get (\ref{SHORT.lem:mid>length}).

To prove (\ref{SHORT.lem:mid>geod:geod}), 
one should repeat the same argument 
taking midpoints instead of $\eps_n$-midpoints.
In this case \ref{eq:eps-midpoint} holds for $\eps_n=\eps=0$.
\qeds

Since in a compact space a sequence of $1/n$-midpoints $z_n$ contains a convergent subsequence, Lemma  \ref{lem:mid>geod} immediately implies

\begin{thm}{Proposition}
A proper length space is geodesic.
\end{thm}

\begin{thm}{Hopf--Rinow theorem}\label{thm:Hopf-Rinow}
Any complete, locally compact length space is proper.
\end{thm}

\parit{Proof.}
Let $\spc{X}$ be a locally compact length space.
Given $x\in \spc{X}$, denote by $\rho(x)$ the supremum of all $R>0$ such that
the closed ball $\cBall[x,R]$ is compact.
Since $\spc{X}$ is locally compact 
$$\rho(x)>0\ \ \text{for any}\ \ x\in \spc{X}.\eqlbl{eq:rho>0}$$
It is sufficient to show that $\rho(x)=\infty$ for some (and therefore any) point $x\in \spc{X}$.

Assume the contrary; that is, $\rho(x)<\infty$.

\begin{clm}{} $B=\cBall[x,\rho(x)]$ is compact for any $x$.
\end{clm}

Indeed, $\spc{X}$ is a length space;
therefore for any $\eps>0$, 
the set $\cBall[x,\rho(x)-\eps]$ forms a compact $\eps$-net in $B$.
Since $B$ is closed and hence complete, it has to be compact.
\claimqeds

\begin{clm}{} $|\rho(x)-\rho(y)|\le \dist{x}{y}{\spc{X}}$,
in particular $\rho\:\spc{X}\to\RR$ is a continuous function.
\end{clm}

Indeed, 
assume the contrary; that is, $\rho(x)+|x-y|<\rho(y)$ for some $x,y\in \spc{X}$. 
Then 
$\cBall[x,\rho(x)+\eps]$ is a closed subset of $\cBall[y,\rho(y)]$ for some $\eps>0$.
Then  compactness of $\cBall[y,\rho(y)]$ implies compactness of $\cBall[x,\rho(x)+\eps]$, a contradiction.\claimqeds

Set $\eps=\min_{y\in B}\{\rho(y)\}$; 
the minimum is defined since $B$ is compact.
From \ref{eq:rho>0}, we have $\eps>0$.

Choose a finite $\tfrac\eps{10}$-net $\{a_1,a_2,\dots,a_n\}$ in $B$.
The union $W$ of the closed balls $\cBall[a_i,\eps]$ is compact.
Clearly 
$\cBall[x,\rho(x)+\frac\eps{10}]\subset W$.
Therefore $\cBall[x,\rho(x)+\frac\eps{10}]$ is compact;
a contradiction.
\qeds

\begin{thm}{Exercise}\label{exercise from BH}
Construct a geodesic space which is locally compact,
but whose completion is neither geodesic nor locally compact.
\end{thm}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%











\section{Model angles and triangles.}\label{sec:mod-tri/angles}

Let $\spc{X}$ be a metric space, 
$p,q,r\in \spc{X}$. 
Let us define its \emph{model triangle}\index{model triangle} $\trig{\~p}{\~q}{\~r}$ 
(briefly, 
$\trig{\~p}{\~q}{\~r}=\modtrig(p q r)_{\EE^2}$%
\index{$\modtrig$!$\modtrig({*}{*}{*})_{\EE^2}$}) to be a triangle in the plane $\EE^2$ such that
\[\dist{\~p}{\~q}{}=\dist{p}{q}{},
\ \ \dist{\~q}{\~r}{}=\dist{q}{r}{},
\ \ \dist{\~r}{\~p}{}=\dist{r}{p}{}.\]

In the same way we can define the \emph{hyperbolic} and the \emph{spherical model triangles} $\modtrig(p q r)_{\HH^2}$, $\modtrig(p q r)_{\SS^2}$
in the hyperbolic plane $\HH^2$ and the unit sphere $\SS^2$.
In the latter case the model triangle is said to be defined if in addition
\[\dist{p}{q}{}+\dist{q}{r}{}+\dist{r}{p}{}< 2\cdot\pi.\]
In this case it also exists and is unique up to an isometry of $\SS^2$.

If 
$\trig{\~p}{\~q}{\~r}=\modtrig(p q r)_{\EE^2}$ 
and $\dist{p}{q}{},\dist{p}{r}{}>0$, 
the angle measure of 
$\trig{\~p}{\~q}{\~r}$ at $\~p$ 
will be called the \emph{model angle} of triple $p$, $q$, $r$ and it will be denoted by
$\angk p q r_{\EE^2}$%
\index{$\tangle$!$\angk{{*}}{{*}}{{*}}$}.
In the same way we define $\angk p q r_{\HH^2}$ and $\angk p q r_{\SS^2}$;
in the latter case  we assume in addition that the model triangle $\modtrig(p q r)_{\SS^2}$ is defined.
We may use the notation $\angk p q r$ if it is evident what is the model space $\HH^2$, $\EE^2$ or $\SS^2$.

\begin{wrapfigure}[6]{r}{28mm}
\begin{lpic}[t(-4mm),b(6mm),r(0mm),l(0mm)]{pics/lem_alex1(1)}
\lbl[lb]{10,23;$x$}
\lbl[rt]{1.5,.5;$p$}
\lbl[bl]{25,7.5;$y$}
\lbl[lb]{17,15;$z$}
\end{lpic}
\end{wrapfigure}

\begin{thm}{Alexandrov's lemma}
\index{Alexandrov's lemma}
\index{lemma!Alexandrov's lemma}
\label{lem:alex}  
Let $p,x,y,z$ be distinct points in a metric space such that $z\in \l]x y\r[$.
Then 
the following expressions for the Euclidean model angles have the same sign:
\begin{subthm}{lem-alex-difference}
$\angk x p z
-\angk x p y$,
\end{subthm} 

\begin{subthm}{lem-alex-angle}
$\angk z p x
+\angk z p y -\pi$.
\end{subthm}

Moreover,
\[\angk p x y \ge \angk p x z +  \angk p z y,\]
with equality holding if and only if the expressions in (\ref{SHORT.lem-alex-difference}) and (\ref{SHORT.lem-alex-angle}) vanish.

The same holds for hyperbolic and spherical model angles, 
but in the latter case one has to assume in addition that
\[\dist{p}{z}{}+\dist{p}{y}{}+\dist{x}{y}{}< 2\cdot\pi.\]

\end{thm}

\parit{Proof.} 
Consider the model triangle $\trig{\~x}{\~p}{\~z}=\modtrig(x p z)$.
Take 
a point $\~y$ on the extension of 
$[\~x \~z]$ beyond $\~z$ so that $\dist{\~x}{\~y}{}=\dist{x}{y}{}$ (and therefore $\dist{\~x}{\~z}{}=\dist{x}{z}{}$). 

\begin{wrapfigure}[6]{r}{23mm}
\begin{lpic}[t(-0mm),b(0mm),r(0mm),l(0mm)]{pics/alex-lemma-proof(1)}
\lbl[br]{0,3;$\~x$}
\lbl[lt]{22,1;$\~p$}
\lbl[bl]{18,22;$\~y$}
\lbl[bl]{8,13;$\~z$}
\end{lpic}
\end{wrapfigure}

Since increasing the opposite side in a plane triangle increases the corresponding angle, 
the following expressions have the same sign:
\begin{enumerate}[(i)]
\item $\mangle\hinge{\~x}{\~p}{\~y}-\angk{x}{p}{y}$;
\item $\dist{\~p}{\~y}{}-\dist{p}{y}{}$;
\item $\mangle\hinge{\~z}{\~p}{\~y}-\angk{z}{p}{y}$.
\end{enumerate}
Since 
\[\mangle\hinge{\~x}{\~p}{\~y}=\mangle\hinge{\~x}{\~p}{\~z}=\angk{x}{p}{z}\]
and
\[ \mangle\hinge{\~z}{\~p}{\~y}
=\pi-\mangle\hinge{\~z}{\~x}{\~p}
=\pi-\angk{z}{x}{p},\]
the first statement follows.

For the second statement, construct a model triangle $\trig{\~p}{\~z}{\~y'}\z=\modtrig(pzy)_{\EE^2}$ on the opposite side of $[\~p\~z]$ from $\trig{\~x}{\~p}{\~z}$.  
Note that 
\begin{align*}
\dist{\~x}{\~y'}{}
&\le \dist{\~x}{\~z}{} + \dist{\~z}{\~y'}{}=
\\
&=\dist{x}{z}{}+\dist{z}{y}{}=
\\
&=\dist{x}{y}{}.
\intertext{Therefore}
\angk{p}{x}{z} + \angk{p}{z}{y} 
&
= 
\mangle\hinge{\~p}{\~x}{\~z}+ \mangle\hinge{\~p}{\~z}{\~y'} 
=
\\
&
= 
\mangle\hinge{\~p}{\~x}{\~y'}
\le
\\
&\le  \angk p x y.
\end{align*}
Equality holds if and only  if $\dist{\~x}{\~y'}{}=\dist{x}{y}{}$, 
as required.
\qeds

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Angles and the first variation.}\label{sec:angles}

Given a hinge $\hinge p x y$, we define its \emph{angle}\index{angle} as 
follows:\index{$\mangle$!$\mangle\hinge{{*}}{{*}}{{*}}$}
\[\mangle\hinge p x y
\df
\lim_{\bar x,\bar y\to p} \angk p{\bar x}{\bar y}_{\EE^2},\eqlbl{eq:def-angle}\]
where $\bar x\in\l]p x\r]$ and $\bar y\in\l]p y\r]$.
The angle under the limit can be calculated from the  cosine law:
\[\cos\angk{p}{x}{y}_{\EE^2}
=
\frac{\dist[2]{p}{x}{}+\dist[2]{p}{y}{}-\dist[2]{x}{y}{}}{2\cdot \dist[{{}}]{p}{x}{}\cdot\dist[{{}}]{p}{y}{}}.\]

The following lemma implies that 
the definition of the angle \ref{eq:def-angle} one can use $\angk p{\bar x}{\bar y}_{\SS^2}$ or  $\angk p{\bar x}{\bar y}_{\HH^2}$ instead of $\angk p{\bar x}{\bar y}_{\EE^2}$.


\begin{thm}{Lemma}\label{lem:k-K-angle}
For any three points $p,x,y$ in a metric space the following inequalities
\[
\begin{aligned}
|\angk p{x}{y}_{\SS^2}-\angk p{x}{y}_{\EE^2}|
&\le 
\dist[{{}}]{p}{x}{}\cdot\dist[{{}}]{p}{y}{},
\\
|\angk p{x}{y}_{\HH^2}-\angk p{x}{y}_{\EE^2}|
&\le 
\dist[{{}}]{p}{x}{}\cdot\dist[{{}}]{p}{y}{},
\end{aligned}
\eqlbl{eq:k-K}\]
hold whenever the left hand side is defined.
\end{thm}


\parit{Proof.}
Note that 
\[\angk p{x}{y}_{\HH^2}\le\angk{p}{x}{y}_{\EE^2}\le \angk p{x}{y}_{\SS^2}.\]
Therefore
\begin{align*}
0&\le \angk p{x}{y}_{\SS^2}-\angk p{x}{y}_{\HH^2}\le
\\
&\le \angk p{x}{y}_{\SS^2}+\angk {x}p{y}_{\SS^2}+\angk {y}p{x}_{\SS^2}-\angk p{x}{y}_{\HH^2}-\angk {x}p{y}_{\HH^2}-\angk {y}p{x}_{\HH^2}
= 
\\
&=\area\modtrig(pxy)_{\SS^2}+\area\modtrig(pxy)_{\HH^2}.
\end{align*}
Thus, \ref{eq:k-K} follows since 
\begin{align*}
0
&\le
\area\modtrig(pxy)_{\HH^2}\le 
\\
&\le\area\modtrig(pxy)_{\SS^2}\le
\\
&\le\dist[{{}}]{p}{x}{}\cdot\dist[{{}}]{p}{y}{}.
\end{align*}
\qedsf



\begin{thm}{Triangle inequality for angles}
\label{claim:angle-3angle-inq}
Let  $[px^1]$, $[px^2]$ and $[px^3]$ %$\gamma^1, \gamma^2, \gamma^3$ 
be three geodesics in a metric space.
If all  the angles $\alpha^{i j}=\mangle\hinge p {x^i}{x^j}$ are defined then they satisfy the triangle inequality:
\[\alpha^{13}\le \alpha^{12}+\alpha^{23}.\]

\end{thm}




\parit{Proof.} 
Since $\alpha^{13}\le\pi$, we can assume that $\alpha^{12}+\alpha^{23}< \pi$.
Set $\gamma^i=\geod_{[px^i]}$.
Given any $\eps>0$, for all sufficiently small $t,\tau,s\in\RR_+$ we have
\begin{align*}
\dist{\gamma^1(t)}{\gamma^3(\tau)}{}
\le 
&\dist{\gamma^1(t)}{\gamma^2(s)}{}+\dist{\gamma^2(s)}{\gamma^3(\tau)}{}<\\
<
&\sqrt{t^2+s^2-2\cdot t\cdot  s\cdot \cos(\alpha^{12}+\eps)}+
\\
&+\sqrt{s^2+\tau^2-2\cdot s\cdot \tau\cdot \cos(\alpha^{23}+\eps)}\le
\\
\intertext{(Below we define 
$s(t,\tau)$ so that for 
$s=s(t,\tau)$, this chain of inequalities can be continued as follows:)}
\le
&\sqrt{t^2+\tau^2-2\cdot t\cdot \tau\cdot \cos(\alpha^{12}+\alpha^{23}+2\cdot \eps)}.
\end{align*}
Thus for any $\eps>0$, 
\[\alpha^{13}\le \alpha^{12}+\alpha^{23}+2\cdot \eps.\]
Hence the result.

\begin{wrapfigure}{r}{25mm}
\begin{lpic}[t(-0mm),b(-0mm),r(0mm),l(0mm)]{pics/s-choice(1)}
\lbl[w]{12,35,50;$\,t\,$}
\lbl[w]{12,12,-50;$\,\tau\,$}
\lbl[w]{14,22.5,4;$\,s\,$}
\lbl[lw]{9,20,-25;{\small $=\alpha^{12}+\eps$}}
\lbl[lw]{9,26,28;{\small $=\alpha^{23}+\eps$}}
\end{lpic}
\end{wrapfigure}

To define $s(t,\tau)$ to satisfy the above inequality, consider three rays $\~\gamma^1$, $\~\gamma^2$, $\~\gamma^3$ on a Euclidean plane starting at one point, such that $\mangle(\~\gamma^1,\~\gamma^2)=\alpha^{12}+\eps$, $\mangle(\~\gamma^2,\~\gamma^3)=\alpha^{23}+\eps$ and $\mangle(\~\gamma^1,\~\gamma^3)=\alpha^{12}+\alpha^{23}+2\cdot \eps$.
We parametrize each ray by the distance from the starting point.
Given two positive numbers $t,\tau\in\RR_+$, let $s=s(t,\tau)$ be 
the number such that 
$\~\gamma^2(s)\in[\~\gamma^1(t)\ \~\gamma^3(\tau)]$. Clearly $s\le\max\{t,\tau\}$, 
so $t,\tau,s$ may be taken sufficiently small.
\qeds 

\begin{thm}{Exercise}\label{ex:adjacent-angles}
Prove that the sum of adjacent angles is at least $\pi$.

More precisely: let $\spc{X}$ be a complete length space and $p,x,y,z\in \spc{X}$.
If $p\in \l] x y \r[$ then 
\[\mangle\hinge pxz+\mangle\hinge pyz\ge \pi\]
whenever  each angle on the left-hand side is defined.
\end{thm}


\begin{thm}{First variation inequality}\label{lem:first-var}
Assume that for a  hinge $\hinge q p x$ 
the angle $\alpha=\mangle\hinge q p x$ is defined. Then
\[\dist{p}{\geod_{[qx]}(t)}{}
\le
\dist{q}{p}{}-t\cdot \cos\alpha+o(t).\]

\end{thm}

\parit{Proof.} Take sufficiently small $\eps>0$.
For all sufficiently small $t>0$, we have that 
\begin{align*}
 \dist{\geod_{[qp]}(t/\eps)}{\geod_{[qx]}(t)}{}
&\le 
\tfrac{t}{\eps}\cdot \sqrt{1+\eps^2 -2\cdot \eps\cdot \cos\alpha}+o(t)\le
\\
&\le \tfrac{t}{\eps} -t\cdot \cos\alpha + t\cdot \eps.
\end{align*}
Applying triangle inequality, we get 
\begin{align*}
\dist{p}{\geod_{[qx]}(t)}{}
&\le \dist{p}{\geod_{[qp]}(t/\eps)}{}+\dist{\geod_{[qp]}(t/\eps)}{\geod_{[qx]}(t)}{}
\le 
\\
&\le
\dist{p}{q}{} -t\cdot \cos\alpha + t\cdot \eps
\end{align*}
for any $\eps>0$ and all sufficiently small $t$.
Hence the result.
\qeds

\section{Space of directions and tangent space}
\label{sec:tangent-space+directions}

Let $\spc{X}$ be a metric space with defined angles for all hinges.
Fix a point $p\in \spc{X}$. 

Consider the set $\mathfrak{S}_p$ 
of all nontrivial unit-speed geodesics  which start at $p$.
By \ref{claim:angle-3angle-inq} the triangle inequality holds for $\mangle$ on $\mathfrak{S}_p$;
that is, $(\mathfrak{S}_p,\mangle)$ 
forms a pseudometric space; 
that is it satisfies all the conditions of a metric space  except the angle between distinct geodesics might vanish.

The metric space corresponding to  $(\mathfrak{S}_p,\mangle)$ is called the \emph{space of geodesic directions} at $p$
and denoted as $\Sigma'_p$ or $\Sigma'_p\spc{X}$.
Elements of $\Sigma'_p$ are called \emph{geodesic directions} at $p$.
Each geodesic direction is formed by an equivalence class of geodesics in $\mathfrak{S}_p$
for the equivalence relation 
\[[px]\sim[py]\ \ \iff\ \ \mangle\hinge pxy=0.\]

%??? MOVE IT BACK ONCE IF CBB ARE BACK
%\begin{thm}{Exercise}\label{ex:geod-CBB}
%Assume $\spc{L}$ is a $\CBB{}{}$ space,  and $[px]$, $[py]$ be two geodesics  which correspond to the same geodesic direction $\xi\in \Sigma'_p$.
%Show that 
%\[[px]\subset [py]\ \ \text{or}\ \ [px]\supset [py].\]
%
%\end{thm}

\begin{thm}{Exercise}\label{ex:geod-CBA}
Assume $\spc{U}$ is a $\Cat{}{\kappa}$ proper length space
 with extendable geodesics;
that is, any geodesic in $\spc{U}$
is an arc in an infinite local geodesic defined on $\RR$.

Show that the space of geodesic directions 
$\Sigma_p'$ is complete for any $p\in \spc{U}$.
\end{thm}

The completion of $\Sigma'_p$ is called the \emph{space of directions} at $p$ and is denoted as $\Sigma_p$ or $\Sigma_p\spc{X}$.
Elements of $\Sigma_p$ are called \emph{directions} at $p$.

The Euclidean cone $\Cone\Sigma_p$ over the space of directions $\Sigma_p$ is called the tangent space at  $p$ and denoted as $\T_p$ or $\T_p\spc{X}$.

The tangent space $\T_p$ could be also defined directly, without introducing the space of direction.
To do so consider the set $\mathfrak{T}_p$ of all geodesics starting at $p$, with arbitrary speed.
Given $\alpha,\beta\in \mathfrak{T}_p$,
set 
\[\dist{\alpha}{\beta}{\mathfrak{T}_p}
=
\lim_{\eps\to0} 
\frac{\dist{\alpha(\eps)}{\beta(\eps)}{\spc{X}}}\eps
\eqlbl{eq:dist-in-T_p}\]
Since the angles in $\spc{X}$ are defined, 
\ref{eq:dist-in-T_p}
defines a pseudometric on $\mathfrak{T}_p$.


The corresponding metric space admits a natuaral isometric identification with the cone $\T'_p=\Cone\Sigma'_p$.
Elements of $\T'_p$ are formed by the equivalence classes for the realtion 
\[\alpha\sim\beta\ \ \iff\ \ \dist{\alpha(t)}{\beta(t)}{\spc{X}}=o(t).\]
The completion of $\T'_p$ is therefore  natuaraly isometric to $\T_p$.

Elements of $\T_p$ will be called \index{tangent vector}\emph{tangent vectors} at $p$,
even though $\T_p$ is only metric cone and need not be a vector space.
Elements of $\T'_p$ will be called \index{geodesic tangent vector}\emph{geodesic tangent vectors} at $p$.

\section{Hausdorff convergence}

It seems that Hausdorff convergence was first introduced by Hausdorff in \cite{hausdorff}
and couple of years later an equivalent definition was given by Blaschke in \cite{blaschke}.
Further a refinement of this definition was introduced by Frol\'{\i}k in \cite{frolik}
and then rediscovered by Wijsman in \cite{wijsman},
however this refinement was a step back to so called \emph{closed convergence} introduced by Hausdorff in the original book. 
By that reason we call it Hausdorff convergence
instead of
\emph{Hausdorff--Blascke--Frol\'{\i}k--Wijsman convergence}.


Let $\spc{X}$ be a metric space and $A\subset \spc{X}$.
We will denote by $\dist{A}{}{}(x)$ the distance from $A$ to a point $x$ in $\spc{X}$;
that is,
$$\dist{A}{}{}(x)\df\inf\set{\dist{a}{x}{\spc{X}}}{a\in A}.$$

\begin{thm}{Definition of Hausdorff convergence}\label{def:hausdorff-coverge}
Given a sequence of closed sets $(A_n)_{n=1}^\infty$ in a metric space $\spc{X}$ 
a closed set $A_\infty\subset \spc{X}$ is called Hausdorff limit of $(A_n)_{n=1}^\infty$,
briefly $A_n\to A_\infty$ if 
$$\dist{A_n}{}{}(x)\to\dist{A_\infty}{}{}(x)\ \ \t{as}\ \ n\to\infty$$
for any fixed $x\in \spc{X}$.

In this case the sequence of closed sets $(A_n)_{n=1}^\infty$ is called \emph{converging in the sense of Hausdorff}.
\end{thm}

\parbf{Example.}
Let $D_n$ be the disc on the coordinate plane 
centered at $(0,n)$ and radius $n$.
Then $D_n$ converges to the upper half-plane as $n\to\infty$.


\begin{thm}{Selection theorem}
Let $\spc{X}$ be a proper metric space
and $(A_n)_{n=1}^\infty$ be a sequence of closed sets in $\spc{X}$.
Assume that for some (and therefore any) point  $x\in\spc{X}$ 
the sequence $\dist{A_n}{}{}(x)$ is bounded.
Then the sequence  $(A_n)_{n=1}^\infty$ has a converging subsequence in the sense of Hausdorff.
\end{thm}

\parit{Proof.}
Since $X$ is proper,
we can choose a countable dense set $\{x_1,x_2,\dots\}$ in $\spc{X}$.
Note that the sequence $a_n=\dist{A_n}{}{}(x_\kay)$ is bounded for each $\kay$. 
Therefore, passing to a subsequence of $(A_n)_{n=1}^\infty$,
we can assume that $\dist{A_n}{}{}(x_\kay)$ is converging as $n\to\infty$ for any fixed $\kay$.

Note that for each $n$, the function $\dist{A_n}{}{}\:\spc{X}\to\RR$ is 1-Lipschitz and nonnegative.
Therefore the sequence $\dist{A_n}{}{}$ converges pointwise to a 1-Lipschitz nonnegative function $f\:\spc{X}\to\RR$.

Set $A_\infty=f^{-1}(0)$.
Since $f$ is 1-Lipschitz, 
\[\dist{A_\infty}{}{}(y)\ge f(y)\] 
for any $y\in \spc{X}$.
It remains to show that 
\[\dist{A_\infty}{}{}(y)\le f(y)\] 
for any $y$.

Assume contrary;
that is, 
\[f(z)<R<\dist{A_\infty}{}{}(z)\] 
for some $z\in \spc{X}$ and $R>0$.
Then for any large enough $n$ there is a point $z_n\in A_n$ such that
$\dist{x}{z_n}{}\le R$.
Since $\spc{X}$ is proper, we can pass to a partial limit $z_\infty$ of $z_n$ as $n\to\infty$.

Clearly that $f(z_\infty)=0$, that is, $z_\infty\in A_\infty$.
On the other hand, 
\begin{align*}
\dist{A_\infty}{}{}(y)
\le
\dist{z_\infty}{y}{}
\le R
<
\dist{A_\infty}{}{}(y),
\end{align*}
a contradiction.
\qeds

\section{Gromov--Hausdorff convergence}

\begin{thm}{Definition}\label{def:comp-metr}
Let $\set{\spc{X}_\alpha}{\alpha\in\IndexSet}$ be a set of metric spaces.
A metric $\rho$ on the disjoint union
$$\bm{X}=\bigsqcup_{\alpha\in\IndexSet} \spc{X}_\alpha$$
is called \emph{compatible metric}\index{compatible}
if the restriction of $\rho$ to every $\spc{X}_\alpha$ is the original metric on $\spc{X}_\alpha$.
\end{thm}

\begin{thm}{Definition}\label{def:GH}
Let $\spc{X}_1,\spc{X}_2,\dots$ 
and $\spc{X}_\infty$ be proper metric spaces 
and $\rho$ is a compatible metric on their disjoint union $\bm{X}$.
Assume that $\spc{X}_n$ forms an open set in 
$(\bm{X},\rho)$ for each $n\ne\infty$ and 
$\spc{X}_n\to \spc{X}_\infty$ in $(\bm{X},\rho)$ as $n\to\infty$ in the sense of Hausdorff, see Definition~\ref{def:hausdorff-coverge}.

In this case we say that $\rho$ defines a 
\emph{convergence%
\footnote{Formally speaking, \emph{convergence} is the topology induced by $\rho$ on $\bm{X}$.} 
in the sense of Gromov--Hausdorff}%
\index{convergence in the sense of Gromov--Hausdorff}
and we write $\spc{X}_n\to \spc{X}_\infty$ or $\spc{X}_n\xto{\rho} \spc{X}_\infty$.
The space $\spc{X}_\infty$ is called the limit space of the sequence $(\spc{X}_n)$ along $\rho$.
\end{thm}

Usually Gromov--Hausdorff convergence is defined differently,
we prefer this definition since it induce the convergence for a sequence of points $x_n\in\spc{X}_n$ 
as well as 
weak convergence of measures $\mu_n$ on $\spc{X}_n$ and so on
as the corresponding convergence in the ambient space $(\bm{X},\rho)$.

Once we write $\spc{X}_n\to \spc{X}_\infty$ we mean that we made a choice of convergence.
Note that for a fixed sequence of metric spaces $\spc{X}_1,\spc{X}_2,\dots$ one may construct different Gromov--Hausdorff convergences, say $\spc{X}_n\xto{\rho} \spc{X}_\infty$ and $\spc{X}_n\xto{\rho'} \spc{X}_\infty'$  and their limit spaces $\spc{X}_\infty$ and $\spc{X}_\infty'$ need not to be isometric to each other. 

For example, for the constant sequence $\spc{X}_n\iso\RR_{\ge0}$, 
there is a convergence with limit $\spc{X}_\infty\iso\RR_{\ge0}$; 
guess the metric $\rho$ from the diagram.

\begin{center}
\begin{lpic}[t(-0mm),b(-0mm),r(0mm),l(0mm)]{pics/P2P(1)}
\lbl[b]{55,22;$\spc{X}_1$}
\lbl[b]{55,12;$\spc{X}_2$}
\lbl[b]{55,8;$\dots$}
\lbl[t]{55,0;$\spc{X}_\infty$}
\end{lpic}
\end{center}

For an other metric $\rho'$ --- also guess it from the diagram ---
the limit space $\spc{X}_\infty'$ is isometric to the real line.

\begin{center}
\begin{lpic}[t(-0mm),b(-0mm),r(0mm),l(0mm)]{pics/P2R(1)}
\lbl[b]{55,22;$\spc{X}_1$}
\lbl[b]{35,12;$\spc{X}_2$}
\lbl[b]{15,8;$\dots$}
\lbl[t]{55,0;$\spc{X}_\infty'$}
\end{lpic}
\end{center}

%???DO WE NEED LIFTINGS???
\parbf{Liftings.}
Given a Gromov--Hausdorff convergence 
$\spc{X}_n\to \spc{X}_\infty$
and a point $p_\infty\in\spc{X}_\infty$ any sequence of points $p_n\in\spc{X}_n$ such that $p_n\to p$  will be called \emph{lifting}\index{lifting of a point} of $p_\infty$.
In this case the point $p_n\in \spc{X}_n$ will be called a lifting of $p_\infty$ in $\spc{X}_n$
and the distance function $\dist{p_n}{}{}\:\spc{X}_n\to \RR$ 
is called \emph{lifting}\index{lifting of a distance function} 
of $\dist{p}{}{}\:\spc{X}\to \RR$ to $\spc{X}_n$.

Note that liftings are not uniquely defined.
We will be interested in the properties of liftings for sufficiently large $n$.

\begin{thm}{Selection theorem}\label{thm:gromov-selection}
Let $\spc{X}_n$ be a sequence of proper metric spaces 
with marked points $x_n\in \spc{X}_n$.
Assume that for any fixed $R,\eps>0$ there is $N=N(R,\eps)\in\NN$ 
such that for each $n$
the ball $\cBall[x_n,R]\subset \spc{X}_n$ admits a finite $\eps$-net with at most $N$ points.
Then there is a subsequence of $\spc{X}_n$ which admit a Gromov--Hausdorff convergence 
such that the sequence of marked points $x_n\in\spc{X}_n$ converges.
\end{thm}

\parit{Proof.}
From the main assumption in the theorem,
in each space $\spc{X}_n$ 
there is a sequence of points $z_{i,n}\in\spc{X}_n$ such that the following condition hold for a fixed sequence of integers $M_1<M_2<\dots$
\begin{itemize}
\item $\dist{z_{i,n}}{x_n}{\spc{X}_n}\le \kay+1$ if $i\le M_\kay$;
\item the points $z_{1,n},\dots,z_{M_\kay,n}$ form an $\tfrac1\kay$-net in $\cBall[x_n,\kay]_{\spc{X}_n}$.
\end{itemize}

Passing to a subsequence, we can assume that the sequence \[\ell_n=\dist{z_{i,n}}{z_{j,n}}{\spc{X}_n}\] 
converges for any $i$ and $j$.

Let us consider countable set of points $\spc{W}=\{w_1,w_2,\dots\}$
equipped with the pseudometric defined as 
\[\dist{w_i}{w_j}{\spc{W}}
=
\lim_{n\to\infty}\dist{z_{i,n}}{z_{j,n}}{\spc{X}_n}.\]
Let $\hat{\spc{W}}$ be the metric space corresponding to $\spc{W}$;
that is, points in $\hat{\spc{W}}$ formed by equivalence classes in $\spc{W}$
for the relation $\sim$ such that $w_i\sim w_j$ if and only it $\dist{w_i}{w_j}{\spc{W}}=0$
and 
\[\dist{[w_i]}{[w_j]}{\hat{\spc{W}}}\df\dist{w_i}{w_j}{\spc{W}}.\]
Denote by
$\spc{X}_\infty$ the completion of $\hat{\spc{W}}$.

It remains to show that there is a Gromov--Hausdorff convergence 
$\spc{X}_n\to\spc{X}_\infty$ such that the sequence $x_n\in\spc{X}_n$ converges.
To prove it, we need to construct a metric $\rho$ on the disjoint union of \[\bm{X}=\spc{X}_\infty\sqcup\spc{X}_1\sqcup\spc{X}_2\sqcup\dots\] 
satisfies definitions \ref{def:comp-metr} and \ref{def:GH}.
The metric $\rho$ can be constructed as the maximal compatible metric
such that 
\[\rho(z_{i,n},w_i)\le\tfrac1m\]
for any $n\ge N_m$ and $i<I_m$ for a suitable choice of two sequences 
$I_m$, $N_m$ with $I_1=N_1=1$.
\qeds



\begin{thm}{Exercise}\label{ex:compact-proper-GH}
Let $\spc{X}_n$ be a sequence of metric spaces which admit 
two convergences $\spc{X}_n\xto{\rho}\spc{X}_\infty$ and $\spc{X}_n\xto{\rho'}\spc{X}_\infty'$.
\begin{subthm}{}
If  $\spc{X}_\infty$ is compact then $\spc{X}_\infty\iso\spc{X}_\infty'$.
\end{subthm}

\begin{subthm}{}
If  $\spc{X}_\infty$ is proper and there is a sequence of points $x_n\in \spc{X}_n$ 
which converges in both convergences 
 then $\spc{X}_\infty\iso\spc{X}_\infty'$.
\end{subthm}
\end{thm}
