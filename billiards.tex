\part{Curvature bounded above}
\chapter{Gluing theorem and billiards}

In this chapter we define $\Cat{}{}$ spaces and give the first application to the billiards.

%%%???MAYBE WE SHOULD ADD A SHORT SECTION ON 4-POINT CONDITION.

\section{Thin triangles} \label{sec:thin-triangle}


The inheritance lemma \ref{lem:inherit-angle} proved below 
plays the central role in the theory;
it will lead to two fundamental constructions: patchwork globalization  (\ref{thm:alex-patch}) 
and Reshetnyak gluing (\ref{thm:gluing})
which in turn used to prove 
the globalization theorem (\ref{thm:hadamard-cartan}).

\medskip

Recall that \emph{triangle} $\trig {x^1}{x^2}{x^3}$ in a space $\spc{X}$ 
is a triple of minimizing geodesics $[x^1x^2]$, $[{x^2}{x^3}]$ and $[{x^3}{x^1}]$.
Consider the  model triangle $\trig{\~x^1}{\~x^2}{\~x^3}=\modtrig{}({x^1}{x^2}{x^3})_{\EE^2}$ in the Euclidean plane.
The  \emph{natural map}\index{natural map} $\trig{\~x^1}{\~x^2}{\~x^3}\to \trig{x^1}{x^2}{x^3}$ 
sends a point $\~z\in[\~x^i\~x^j]$ to the corresponding point $z\in[x^ix^j]$;
that is, $z$ is the point such that $\dist{\~x^i}{\~z}{}=\dist{x^i}{z}{}$ and therefore $\dist{\~x^j}{\~z}{}=\dist{x^j}{z}{}$.

The same way natural map can be defined by the spherical model triangle $\modtrig{}({x^1}{x^2}{x^3})_{\SS^2}$.
 
\begin{thm}{Definition of thin triangles}\label{def:k-thin}
A triangle $\trig{x^1}{x^2}{x^3}$ in the space $\spc{X}$ 
is called \emph{thin}\index{thin} if the natural map $\modtrig{}({x^1}{x^2}{x^3})_{\EE^2}\to \trig{x^1}{x^2}{x^3}$ is short.

Analogously triangle $\trig{x^1}{x^2}{x^3}$ in the space $\spc{X}$ 
is called \emph{spherically thin}\index{spherically thin} if
the natural map from the spherical model triangle $\modtrig{}({x^1}{x^2}{x^3})_{\SS^2}$ to $\trig{x^1}{x^2}{x^3}$ is short.
\end{thm}

\begin{thm}{Definition}
We say that the space $\spc{X}$ is $\Cat{}{0}$ if all its triangles are thin.

Analogously, we say that the space $\spc{X}$ is $\Cat{}{1}$ if all its triangles are spherically thin.
\end{thm}

We could also define $\Cat{}{-1}$ spaces using the natural map from the model triangle in the hyperbolic plane.
Yet more generally one can define $\Cat{}{\kappa}$ spaces for any real value $\kappa$, by using the model triangles in the $\kappa$-plane which is complete simply connected surface of constant curvature $\kappa$.

On the other hand the classes of $\Cat{}{0}$ and $\Cat{}{1}$ are sufficient to show the ideas;
so when you see $\Cat{}{\kappa}$ you can assume $\kappa=0$ or~$1$.
In fact the class of $\Cat{}{0}$ spaces plays the main role,
while $\Cat{}{1}$ spaces will play a role only in due to the following statement.

The cone and suspension are defined in Section \ref{sec:constructions}.

\begin{thm}{Exercise}\label{ex:cone+susp}
Let $\spc{V}$ be a space and $\spc{U}=\Cone\spc{V}$.
Show that $\spc{U}$ is a $\Cat{}{0}$ if and only if $\spc{V}$ is $\Cat{}{1}$.

Analogously, if $\spc{U}=\Susp\spc{V}$ then 
$\spc{U}$ is a $\Cat{}{1}$ if and only if $\spc{V}$ is $\Cat{}{1}$.
\end{thm}

The following exercise is bit simpler, but can be proved essentially the same way.

\begin{thm}{Exercise}\label{ex:product}
Assume $\spc{U}$ and $\spc{V}$ are $\Cat{}{0}$ spaces.
Show that the product space $\spc{U}\times\spc{V}$ is $\Cat{}{0}$.
\end{thm}


\begin{thm}{Uniqueness of geodesics}\label{thm:cat-unique}
In a $\Cat{}{0}$ space, pairs of points are joined by unique geodesics, and these geodesics depend continuously on their endpoint pairs.

Analogously, in a $\Cat{}{1}$ space, pairs of points on distance less than $\pi$ are joined by unique geodesics, and these geodesics depend continuously on their endpoint pairs.
\end{thm}

\parit{Proof.} 
Given 4 points $p^1,p^2,q^1,q^2$ in a $\Cat{}{0}$ space $\spc{U}$, 
consider two triangles $\trig{p^1}{q^1}{p^2}$ and $\trig{p^2}{q^2}{q^1}$.
Since both these triangles are thin, we get 
\begin{align*}
\dist{\geodpath_{[p^1q^1]}(t)}{\geodpath_{[p^2q^1]}(t)}{\spc{U}}
&\le (1-t)\cdot \dist{p^1}{p^2}{\spc{U}},
\\
\dist{\geodpath_{[p^2q^1]}(t)}{\geodpath_{[p^2q^2]}(t)}{\spc{U}}
&\le t\cdot \dist{q^1}{q^2}{\spc{U}}.
\intertext{It follows that}
\dist{\geodpath_{[p^1q^1]}(t)}{\geodpath_{[p^2q^2]}(t)}{\spc{U}}&\le \max\{\dist{p^1}{p^2}{\spc{U}},\dist{q^1}{q^2}{\spc{U}}\}.
\end{align*}

Hence continuity and uniqueness in the $\Cat{}{0}$ case follows.
The $\Cat{}{1}$ case is done essentially the same way.
\qeds


\begin{thm}{Proposition}\label{cor:loc-geod-are-min}
Suppose $\spc{U}$ is a $\Cat{}{0}$ space.  
Then any local geodesic in $\spc{U}$ is a minimizing geodesic.

Analogously, if $\spc{U}$ is a $\Cat{}{1}$ space then any local geodesic with length $<\pi$ in $\spc{U}$ is a minimizing geodesic.
\end{thm}

\parit{Proof.}
Suppose $\gamma\:[0,\ell]\to\spc{U}$ is a local geodesic  that is not minimizing.
Choose $a$ to be the maximal value 
such that $\gamma$ is minimizing on $[0,a]$.
Further choose $b>a$ so that $\gamma$ is minimizing on $[a,b]$.

%???+PIC

Since triangle $\trig{\gamma(0)}{\gamma(a)}{\gamma(b)}$ is thin, we have
\[\dist{\gamma(a-\eps)}{\gamma(a+\eps)}{}<2\cdot\eps\]
for all small $\eps>0$,
a contradiction.

The spherical case is done the same way.
\qeds


Now let us formulate the main result of this section.


\begin{wrapfigure}[6]{r}{30mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/lem_alex1(0.3)}
\lbl[br]{17,59;$y$}
\lbl[r]{1,2;$p$}
\lbl[l]{86,13;$x$}
\lbl[lb]{67,32;$z$}
\end{lpic}
\end{wrapfigure}

\begin{thm}{Inheritance lemma}
\label{lem:inherit-angle} 
Assume that a triangle $\trig p x y$ is \emph{decomposed}\index{decomposed triangle} 
into two triangles $\trig p x z$ and $\trig p y z$;
that is, $\trig p x z$ and $\trig p y z$ have common side $[p z]$, and the sides $[x z]$ and $[z y]$ together form the side $[x y]$ of $\trig p x y$.

If both triangles $\trig p x z$ and $\trig p y z$ are thin, then triangle $\trig p x y$ is thin.

Analogously, if $\trig p x y$ has perimeter $<2\cdot\varpi\kappa$ and both triangles $\trig p x z$ and $\trig p y z$ are spherically thin, then triangle $\trig p x y$ is spherically thin.
\end{thm} 

\parit{Proof.}
Construct model triangles $\trig{\dot p}{\dot x}{\dot z}\z=\modtrig(p x z)_{\EE^2}$ 
and $\trig {\dot p} {\dot y} {\dot z}=\modtrig(p y z)_{\EE^2}$ so that $\dot x$ and $\dot y$ lie on opposite sides of $[\dot p\dot z]$.

\begin{wrapfigure}{r}{28mm}
\begin{lpic}[t(2mm),b(0mm),r(0mm),l(0mm)]{pics/cat-monoton-ineq(0.45)}
\lbl[b]{23,29;$\dot z$}
\lbl[lt]{20,1;$\dot p$}
\lbl[r]{0,20;$\dot x$}
\lbl[l]{51,20;$\dot y$}
\lbl[tl]{23,19;$\dot w$}
\end{lpic}
\end{wrapfigure}

Let us show that 
\[\angk{z}{p}{x}+\angk{z}{p}{y}
\ge
\pi.
\eqlbl{eq:<+<>=pi}\]
Suppose contrary, that is
\[\angk{z}{p}{x}+\angk{z}{p}{y}
<
\pi.\]
Then for some point $\dot w\in[\dot p\dot z]$, we have \[\dist{\dot x}{\dot w}{}+\dist{\dot w}{\dot y}{}
<
\dist{\dot x}{\dot z}{}+\dist{\dot z}{\dot y}{}=\dist{x}{y}{}.\]
Let $w\in[p z]$ correspond to $\dot w$; that is $\dist{z}{w}{}=\dist{\dot z}{\dot w}{}$. 
Since $\trig p x z$ and $\trig p y z$ are thin, we have 
\[\dist{x}{w}{}+\dist{w}{y}{}<\dist{x}{y}{},\]
contradicting the triangle inequality. 

Now consider the set 
\[\dot D=\Conv\trig {\dot p}{\dot x}{\dot z}\cup \Conv\trig {\dot p} {\dot y} {\dot z}.\]
By \ref{eq:<+<>=pi}, there is a short map $F$ that sends 
$\trig{\~ p}{\~ x}{\~ y}$ to
in such a way that 
\begin{align*}
\~p&\mapsto \dot p,
&
\~x&\mapsto \dot x,
&
\~z&\mapsto \dot z,
&
\~y&\mapsto \dot y.
\end{align*}

\begin{thm}{Exercise}\label{ex:short-map}
Prove the last statement. 
\end{thm}


By assumption, the natural maps $\trig {\dot p} {\dot x} {\dot z}\to\trig p x z$ and $\trig {\dot p} {\dot y} {\dot z}\to\trig p y z$ are short.  
By composition,  the natural map from $\trig{\~ p}{\~ x}{\~ y}$ to $\trig p y z$ is short, as claimed.

The spherical case is done along the same lines.
\qeds

Recall that a set $A$ in a metric space $\spc{U}$ is called locally convex if for any point $p\in A$ there is a open neighborhood $\Omega\ni p$ such that any geodesic with the ends in $A$ which lie in $\Omega$ lies in $A$. 

\begin{thm}{Exercise}\label{ex:convex-balls}
Any ball in a $\Cat{}{0}$ space forms a convex set.

Analogousely, any ball in a $\Cat{}{1}$ space of radius $R<\tfrac\pi2$ forms a convex set.
\end{thm}

\begin{thm}{Exercise}\label{ex:locally-convex}
Show that in any $\Cat{}{0}$ space any closed connected locally convex set is convex.
\end{thm}

\begin{thm}{Exercise}\label{ex:closest-point}
Let  $\spc{U}$ be a $\Cat{}0$ space 
and $K\subset \spc{U}$ be a closed convex set.
Show that 

\begin{subthm}{}
For each point $p\in \spc{U}$ there is unique point $p^*\in K$ which minimize the distance $\dist{p}{p^*}{}$.
\end{subthm}

\begin{subthm}{}
The defined closest-point projection $p\mapsto p^*$ is short. 
\end{subthm}

\end{thm}


\section{Reshetnyak's gluing theorem}\label{sec:cba-gluing}

Suppose 
$\spc{U}^1$ and $\spc{U}^2$ are spaces 
with isometric closed convex sets $A^i\subset\spc{U}^i$ and $\iota\:A^1\to A^2$ be an isometry.
Consider the space $\spc{W}$ of all equivalence classes on $\spc{U}^1\sqcup\spc{U}^2$ for the equivalence relation such that $a\sim\iota(a)$ for any $a\in A^1$.

It is straightforward to see that $\spc{W}$ forms a space if equipped with the following metric
\begin{align*}
\dist{x}{y}{\spc{W}}&=\dist{x}{y}{\spc{U}^i}
\\
&\text{if}\quad x,y\in \spc{U}^i,\quad\text{and}
\\
\dist{x}{y}{\spc{W}}&=\min\set{\dist{x}{a}{\spc{U}^1}+\dist{y}{\iota(a)}{\spc{U}^2}}{a\in A^1}
\\
&\text{if}\quad x\in \spc{U}^1\quad\text{and}\quad y\in \spc{U}^2.
\end{align*}
Abusing notation, we denoted by $x$ and $y$ the points in $\spc{U}^1\sqcup\spc{U}^2$ and their equivalence classes in $\spc{U}^1\sqcup\spc{U}^2/{{\sim}}$.

The obtained space $\spc{W}$ is called \emph{gluing} of of $\spc{U}^1$ and  $\spc{U}^2$ along $\iota$.
If one apply this construction to two copies of one space $\spc{U}$ with a set $A\subset \spc{U}$ and identity map $\iota\:A\to A$ then the obtained space is called \emph{doubling} of $\spc{U}$ in $A$.

We can (and will) identify $\spc{U}^i$ with its image in $\spc{W}$;
this way both subsets $A^i\subset \spc{U}^i$ will be identified and denoted further by $A$.
Note that $A=\spc{U}^1\cap \spc{U}^2\subset \spc{W}$,
therefore $A$ is also convex set in $\spc{W}$.

The following theorem was proved by Reshetnyak in \cite{reshetnyak:glue}.
Recall, that once you see $\Cat{}{\kappa}$, you may read $\Cat{}{0}$ or $\Cat{}{1}$.

\begin{thm}{Reshetnyak gluing}\label{thm:gluing}
Suppose 
$\spc{U}^1$ and $\spc{U}^2$ are $\Cat{}{\kappa}$ spaces 
with isometric closed sets $A^i\subset\spc{U}^i$ and $\iota\:A^1\to A^2$ is an isometry.
Then the gluing of $\spc{U}^1$ and  $\spc{U}^2$ along $\iota$ is $\Cat{}{0}$ space.
\end{thm}

\parit{Proof.} 
By construction of gluing space, the statement can be reformulated the following way.

\begin{thm}{Reformulation of \ref{thm:gluing}}
Let $\spc{W}$ be a space which has two closed convex sets $\spc{U}^1,\spc{U}^2\subset\spc{W}$ such that
$\spc{U}^1\cup\spc{U}^1=\spc{W}$ and $\spc{U}^1$, $\spc{U}^2$ are $\Cat{}{\kappa}$.
Then $\spc{W}$ is a $\Cat{}{\kappa}$ space.
\end{thm}


\begin{wrapfigure}{r}{20mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]
{pics/resh-glue(1)}
\lbl[l]{6.5,21;$x^0$}
\lbl[r]{1.5,1.5;$x^1$}
\lbl[tl]{16,0.5;$x^2$}
\lbl[rb]{4,11;$z^1$}
\lbl[lb]{13,8;$z^2$}
\end{lpic}
\end{wrapfigure}

It is sufficient to show that any triangle $\trig {x^0}{x^1}{x^2}$  
in $\spc{W}$ is thin.
This is obviously true if all three points $x^0$, $x^1$, $x^2$ lie in one of $\spc{U}^i$.
Thus, without loss of generality, we may assume that $x^0\in\spc{U}^1$ and $x^1,x^2\in\spc{U}^2$.

Choose points $z^1,z^2\in A$ 
which lie correspondingly on the sides $[x^0x^1], [x^0x^2]$.
Note that
\begin{itemize}
\item triangle $\trig{x^0}{z^1}{z^2}$ lies in $\spc{U}^1$,
\item both triangles $\trig{x^1}{z^1}{z^2}$ and $\trig{x^1}{z^2}{x^2}$ lie in $\spc{U}^2$.
\end{itemize}
In particular each triangle $\trig{x^0}{z^1}{z^2}$,
$\trig{x^1}{z^1}{z^2}$ and $\trig{x^1}{z^2}{x^2}$ is thin.

Applying the inheritance lemma for thin triangles (\ref{lem:inherit-angle}) twice 
we get that $\trig {x^0}{x^1}{z^2}$ 
and consequently $\trig {x^0}{x^1}{x^2}$ is thin.
\qeds 

\begin{thm}{Exercise}\label{ex:two-rays}
Let $Q$ be the nonconvex subset of the plane 
bounded by two rays $\tilde\gamma^1$ and $\tilde\gamma^2$
with common starting point and angle $\alpha$ between them.
Assume $\spc{U}$ is a $\Cat{}{0}$ space
and $\gamma^1,\gamma^2$ be two rays in $\spc{U}$
starting point and angle $\alpha$ between them.
Show that the space glued from $Q$ and $\spc{U}$ along the corresponding rays is a $\Cat{}{0}$ space.
\end{thm}

\begin{thm}{Exercise}\label{ex:branching-cover} 
Let $\spc{U}$ be a $\Cat{}{0}$ space.
Assume $\tilde{\spc{U}}\to \spc{U}$ is a metric covering branching along a geodesic.
Show that $\tilde{\spc{U}}$ is a $\Cat{}{0}$ space.
\end{thm}

\section{Reshetnyak's puff pastry}\label{sec:puff-pastry}

In this section we introduce \emph{Reshetnyak's puff pastry}, 
a construction which will be used in the next section to prove Collision Theorem~\ref{thm:collision}.

Let $\bm{A}=(A^1,\dots,A^N)$ be an array of convex closed sets in the Euclidean space $\EE^m$.
Consider an array of $N+1$ copies of $\EE^m$.
Assume that the space $\spc{R}$ is 
obtained by
gluing successive pairs of spaces in the array  
along $A^1,\dots,A^N$ respectively.

\begin{wrapfigure}{r}{58mm}
\begin{lpic}[t(0mm),b(4mm),r(0mm),l(0mm)]{pics/puff-pastry-example(1)}
\lbl[b]{18,24;$A$}
\lbl[b]{38,24;$B$}
\lbl[w]{53,2,-11;$\spc{R}^0$}
\lbl[w]{53,8,-11;$\spc{R}^1$}
\lbl[w]{53,12,11;$\spc{R}^2$}
\lbl[w]{53,18,11;$\spc{R}^3$}
\lbl[b]{28,-4;Puff pastry for $(A,B,A)$.}
\end{lpic}
\end{wrapfigure}

The obtained space $\spc{R}$  will be called \emph{Reshetnyak's puff pastry} for the array $\bm{A}$.
The copies of $\EE^m$ in the puff pastry $\spc{R}$
will be called \emph{levels};
they will be denoted by $\spc{R}^0,\dots,\spc{R}^N$.
The point in the $\kay$-th level $\spc{R}^\kay$
which corresponds to $x\in \EE^m$
will be denoted by $x^\kay$.

Given $x\in \EE^m$, any point $x^\kay\in\spc{R}$ is called a \emph{lifting} of $x$;
we also can consider the  liftings of maps to $\EE^m$, 
in particular the liftings of subsets in $\EE^m$.

Note that 
\begin{itemize}
\item The intersection $A^1\cap\dots\cap A^N$ admits a unique lifting in $\spc{R}$.
\item Moreover, $x^i=x^j$ for some $i<j$
if and only if $x\in A^{i+1}\cap\dots\cap A^j$.
\item The restriction $\spc{R}^\kay\to \EE^m$
of the natural projection $x^\kay\mapsto x$ is an isometry.
\end{itemize}




\begin{thm}{Observation}\label{obs:puff pastry is CAT}
Any Reshetnyak's puff pastry is a $\Cat{}{0}$ space.
\end{thm}

\parit{Proof.} Apply Reshetnyak's gluing theorem \ref{thm:gluing} recursively for the convex sets in the array.
\qeds

\begin{thm}{Proposition}\label{prop:A-check-A}
Assume $(A^1,\dots,A^N)$ and $(\check A^1,\dots,\check A^N)$ are two arrays of convex closed sets in $\EE^m$ 
such that $ A^\kay\subset \check A^\kay$ for each $\kay$.
Let $\spc{R}$ and $\check{\spc{R}}$ be the corresponding Reshetnyak's  puff pastries.
Then the map $\spc{R}\to\check{\spc{R}}$
defined as $x^\kay\mapsto\check x^\kay$ is short.

Moreover, if  
\[\dist{x^i}{y^j}{\spc{R}}=\dist{\check x^i}{\check y^j}{\check{\spc{R}}}\]
for some $x,y\in \EE^m$ and $i,j\in \{0,\dots,n\}$,
then the geodesic $[\check x^i \check y^j]_{\check{\spc{R}}}$ 
is the image of geodesic $[x^i y^j]_{\spc{R}}$
under the map $x^i\mapsto \check x^i$.
\end{thm}

\parit{Proof.}
The first statement in the proposition 
follows from the construction of Reshetnyak's  puff pastries.

By Observation~\ref{obs:puff pastry is CAT}, 
$\spc{R}$  and  $\check{\spc{R}}$ are $\Cat{}{0}$ spaces, 
hence $[x^i y^j]_{\spc{R}}$ 
and $[\check x^i \check y^j]_{\check{\spc{R}}}$ 
 are unique.  Since the map $\spc{R}\to\check{\spc{R}}$ is short, the image of $[x^i y^j]_{\spc{R}}$
is a geodesic of $\check{\spc{R}}$ joining $\check x^i$ to $\check y^j$.
Hence the second statement follows.
\qeds

\begin{thm}{Definition}
A Reshetnyak's puff pastry $\spc{R}$ 
is called \emph{end-to-end convex} 
if the union of lower and upper levels 
forms a convex set in $\spc{R}$.
\end{thm}

If $\spc{R}$ is the Reshetnyak's puff pastry for an array of convex sets $\bm{A}=(A^{1},\dots, A^{N})$
then $\spc{R}$ is end-to-end convex
if and only if the union of lower and upper levels
$\spc{R}^0\cup\spc{R}^N$ is isometric to the doubling of $\EE^m$ in the nonempty intersection $A^1\cap\dots\cap A^N$.


\begin{thm}{Observation}\label{obs:end-to-end-convex}
Let $\check{\bm{A}}$ and $\bm{A}$ be arrays of convex bodies in $\EE^m$.
Assume 
the  array $\bm{A}$ is
obtained by inserting in $\check{\bm{A}}$, 
copies of the bodies which were already listed in $\check{\bm{A}}$.

For example, if $\check{\bm{A}}=(A,C,B,C,A)$, by placing $B$ in the second place and $A$ in the fourth place, we can obtain $\bm{A}=(A,B,C,A,B,C,A)$.

Denote by $\check{\spc{R}}$ and $\spc{R}$ 
the Reshetnyak's puff pastries for $\check{\bm{A}}$ and $\bm{A}$ respectively.

If $\check{\spc{R}}$ is end-to-end convex then so is $\spc{R}$.
\end{thm}

\parit{Proof.}
Without loss of generality we can assume that $\bm{A}$ is 
obtained by inserting one element in $\check{\bm{A}}$,
say at the place number $\kay$.

Note that $\check{\spc{R}}$ is isometric to the puff pastry 
for $\bm{A}$ with $A^\kay$ replaced by $\EE^m$.
It remains to apply Proposition~\ref{prop:A-check-A}.
\qeds

%???PIC

Let $X$ be a convex set in a Euclidean space.
By a \emph{dihedral angle} we understand an intersection of two half-spaces;
the intersection of corresponding hyperplanes is called the \emph{edge} of the angle.
We say that a dihedral angle $D$ is supporting $X$ at point $p\in X$ 
if $D$ contains $X$ and the edge of $D$ contains $p$.

\begin{thm}{Lemma}\label{lem:end-to-end-convex}
Let $A$ and $B$ be two convex sets in $\EE^m$.
Assume that any dihedral angle supporting $A\cap B$ at some point has measure at least $\alpha$.
Then the Reshetnyak's puff pastry for the array
\[(\underbrace{A,B,A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}}).\]
is end-to-end convex. 
\end{thm}


The proof of the lemma is based its partial case
which we formulate as a sublemma.

\begin{thm}{Sublemma}\label{sublem:end-to-end-convex}
Let $\ddot A$ and $\ddot B$ be two  
half-planes in $\EE^2$, where $\ddot A\cap \ddot B$ is an angle with angle measure $\alpha$.
Then the Reshetnyak's puff pastry for the array \[(\underbrace{\ddot A,\ddot B,\ddot A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}})\]
is end-to-end convex. 
\end{thm}

\begin{wrapfigure}{r}{52mm}
\begin{lpic}[t(-9mm),b(0mm),r(0mm),l(0mm)]{pics/puff-pastry(1)}
\lbl[t]{23,33,6;$\alpha$}
\lbl[b]{20,47,6;$\alpha$}
\lbl[b]{30,3,6;$\alpha$}
\lbl[b]{12.5,13,-71;$\pi-\alpha$}
\lbl[t]{41,23,-71;$\pi-\alpha$}
\end{lpic}
\end{wrapfigure}

\parit{Proof.}
Note that the puff pastry $\ddot{\spc{R}}$ is isometric to the cone over the space glued from the unit circles as shown on the diagram.

All the short arcs on the diagram have length $\alpha$;
the long arcs have length $\pi-\alpha$,
so making a circuit along any path will take $2\cdot\pi$.

Observe that end-to-end convexity of $\ddot{\spc{R}}$
is equivalent to the fact that any geodesic shorter than $\pi$ with the ends on inner and outer circles lies completely in these two circles.

The latter holds if the zigzag line has length at least $\pi$.
This line is formed by $\lceil\tfrac\pi\alpha\rceil$ arcs with length $\alpha$ each.
Hence the sublemma follows.
\qeds



\parit{Proof of Lemma~\ref{lem:end-to-end-convex}.}
Fix arbitrary $x,y\in \EE^m$.
Choose a point $z\in A\cap B$
for which the sum 
\[\dist{x}{z}{}+\dist{y}{z}{}\] 
is minimal.
To show the end-to-end convexity of  $\spc{R}$,
it is sufficient to prove the following.

\begin{clm}{}\label{clm:z in xy}
The geodesic $[x^0y^N]_\spc{R}$ passes though $z^0=z^N\in \spc{R}$.
\end{clm}

Without loss of generality we can assume that $z\in\partial A\cap\partial B$.
Indeed, since the puff pastry for 1-array $(B)$ is end-to-end convex,
Proposition~\ref{prop:A-check-A} together with Observation~\ref{obs:end-to-end-convex}
imply \ref{clm:z in xy} in  case $z$ lies in the interior of $A$.
The same way we can treat the case, $z$ lies in the interior of $B$.

Further we will use the following exercise in convex geometry

\begin{thm}{Exercise}\label{ex:supporting-planes}
There are half-spaces $\dot A$ and $\dot B$ such that
$\dot A\supset A$ and $\dot B\supset B$
and 
\[\dist{x}{z}{}+\dist{y}{z}{}\] 
takes minimal value
for all $z\in \dot A\cap \dot B$.
\end{thm}

\begin{wrapfigure}{r}{35mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/AB-xyz(1)}
\lbl[br]{13,35;$x$}
\lbl[bl]{25,37;$y$}
\lbl[t]{18,28;$z$}
\lbl{8,22;$A$}
\lbl[t]{25,23;$B$}
\lbl[t]{3,33;$\dot A$}
\lbl[t]{31,29;$\dot B$}
\end{lpic}
\end{wrapfigure}

Note that the angle measure of  $\dot A\cap \dot B$ is at least $\alpha$.

Note that $\EE^{m}$ admits isometric splitting $\EE^{m-2}\times \EE^2$ 
such that 
\begin{align*}
\dot A&=\EE^{m-2}\times \ddot A
\\
\dot B&=\EE^{m-2}\times \ddot B
\end{align*}
where $\ddot A$ and $\ddot B$ are half-planes in $\EE^2$.

Let us replace each $A$ by $\dot A$ and each $B$ by $\dot B$
in the array, to get the array
\[(\underbrace{\dot A,\dot B,\dot A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}}).\]
The corresponding puff pastry $\dot{\spc{R}}$
splits as a product of $\EE^{m-2}$ and a puff pastry, 
say $\ddot{\spc{R}}$,
glued from the copies of the plane $\EE^2$ for the array
\[(\underbrace{\ddot A,\ddot B,\ddot A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}}).\]


According to Sublemma~\ref{sublem:end-to-end-convex} and Observation~\ref{obs:end-to-end-convex}, $\ddot{\spc{R}}$ is end-to-end convex.

Since $\dot{\spc{R}}\iso\EE^{m-2}\times\ddot{\spc{R}}$, 
the puff pastry $\dot{\spc{R}}$ is also end-to-end convex.

It follows that the geodesic $[\dot x^0\dot y^N]_{\dot{\spc{R}}}$ passes through $\dot z^0=\dot z^N\in\dot{\spc{R}}$.
By Proposition~\ref{prop:A-check-A}, 
the image of $[\dot x^0\dot y^N]_{\dot{\spc{R}}}$ 
under the map $\dot x^\kay\mapsto x^\kay$
is the geodesic $[x^0 y^N]_{\spc{R}}$.
Hence Claim~\ref{clm:z in xy} follows.
\qeds

The proof of the following proposition is based on Lemma \ref{lem:end-to-end-convex},
which is essentially the case $n=2$.

We say that a closed convex set $A\subset \EE^m$ has  \emph{$\eps$-wide corners} for given $\epsilon >0$ 
if together with each point $p$
the set $A$ contains a small right circular cone
with tip at $p$ and aperture $\eps$.

For example, 
a plane polygon 
has $\eps$-wide corners
if all its interior angles are at least $\eps$.

We will consider finite collections of closed convex sets 
$A^1,\dots,A^n\subset\EE^m$ 
such that for any subset $F\subset\{1,\dots,n\}$
the intersection
$\bigcap_{i\in F}A^i$ 
has $\eps$-wide corners.
In this case we may say briefly \emph{all intesections of $A^i$ have $\eps$-wide corners}.

\begin{thm}{Proposition}\label{prop:end-to-end-convex}
Given $\eps>0$ and a positive integer $n$
there is an array of integers $\bm{j}_\eps=(j_1,\dots,j_N)$ 
such that 

\begin{subthm}{} For each $\kay$ we have $1\le j_\kay\le n$
and each number $1,\dots,n$ appears in $\bm{j}_\eps$ at least once.
\end{subthm}

\begin{subthm}{}
If $A^1,\dots,A^n$ is a collection of closed convex sets in $\EE^m$ with common point 
and all their intersections have $\eps$-wide corners 
then the puff pastry for the array
$(A^{j_1},\dots,A^{j_N})$ is end-to-end convex.
\end{subthm}

Moreover we can assume that $N\le (\lceil\tfrac\pi\eps\rceil+1)^n$.
\end{thm}

\parit{Proof.}
The array $(j_1,\dots,j_N)$ is constructed recursively.
For $n=1$, the array  is $(1)$.

Now assume an array for $n$ is already constructed.
Let us exchange each occurrence of $n$ by the alternating string 
\[\underbrace{n,n+1,n,\dots}_{\text{$\lceil\tfrac\pi\eps\rceil+1$ times}}.\]

Applying Lemma \ref{lem:end-to-end-convex}, 
we get that the obtained array meets the conditions of the proposition.

The upper bound on $N$ follows directly from the construction
and it can be improved easily.
\qeds



\section{Billiards}

Let $A^1,A^2,\dots A^n$ be a finite collection of closed convex sets in $\EE^m$.
Assume that for each $i$
the boundary $\partial A^i$ is a smooth hypersurface.

Consider the billiard table formed by the closure of the complement 
$$T=\overline{\EE^m\backslash \bigcup_{i} A^i}.$$
The sets $A^i$ will be called \emph{walls} of the table $T$ 
and the billiards described above will be called \emph{billiards with convex walls}.

A \emph{billiard trajectory} 
on the table $T$ is a unit-speed broken line $\gamma$ 
which follows  the
standard law of billiards 
at the break points on $\partial A^i$ 
--- in particular, the angle of reflection is equal to the angle of incidence.
The break points of the trajectory will be called \emph{collisions}.
We assume the trajectory meets only one wall at a time.

Recall that $A\subset \EE^m$ has $\eps$-wide corners
if together with each point $p$
the set $A$ contains a small right circular cone
with tip at $p$ and aperture $\eps$.


\begin{thm}{Exercise}\label{ex:compact-walls}
Assume that the walls
of billiard table $T$ 
are compact, convex and have a common  interior point.
Show that all the intersections of  walls of $T$ have $\eps$-wide corners for some $\eps>0$.
\end{thm}

\begin{thm}{Exercise}\label{ex:centrally-simmetric-walls}
Assume that a billiard table $T$ has
centrally symmetric convex walls with common center.
Show that all the intersections of the walls of $T$  have $\eps$-wide corners for some $\eps>0$.
\end{thm}

\begin{thm}{Collision Theorem}\label{thm:collision}
Assume $T\subset\EE^m$
is a billiard table with convex walls.
Assume that the walls of $T$ have common interior point 
and all their intersections have $\eps$-wide corners.
Then the number of collisions of any trajectory in  $T$  is bounded
by a number $N$ which depends only on the number $n$ of walls and $\eps$.
\end{thm}

As you will see from the proof,
the value $N$ can be found explicitly,
say one can take 
\[N=(\lceil\tfrac\pi\eps\rceil+1)^{n^2}.\]

The Collision Theorem was proved by Burago, Ferleger and Kononenko in \cite{BFK};
we present their proof with minor improvements.

Let us formulate and prove a corollary of the  Collision Theorem.

\begin{thm}{Corollary}\label{cor:balls}
Consider $n$ homogeneous hard balls
moving freely and colliding
elastically in empty space $\RR^3$. 
Every ball moves
along a straight line with constant speed until two balls collide, and then
the new velocities of the two balls are determined by the
laws of classical mechanics. 
We assume that only two balls can collide at the same time.

Then the total number of collisions cannot exceed some number $N$ which depends on the radii and masses of the balls.
If the balls are identical then $N$ depends only on $n$.
\end{thm}


The proof below admits a straightforward generalization to all dimensions.

\parit{Proof.}
Denote by $a_i=(x_i,y_i,z_i) \in \RR^3$ the center of the $i$-th ball.
Consider the corresponding point in $\RR^{3\cdot N}$
\begin{align*}
\bm{a}&=(a_1, a_2 , \dots , a_n ) =
\\
&=(x_1, y_1 , z_1 , x_2 , y_2 , z_2 , \dots , x_n , y_n , z_n).
\end{align*}

The $i$-th and $j$-th ball intersect if 
$$|a_i - a_j | \le R_i+R_j,$$
where $R_i$ denoted the radius of the $i$-th ball.
These inequalities define $\tfrac{n\cdot(n-1)}{2}$ cylinders 
\[C_{i,j}=\set{(a_1, a_2 , \dots , a_n )\in\RR^{3\cdot n}} {|a_i - a_j | \le R_i+R_j}.\] 
The closure of the complement
\[T=\overline{\RR^{3\cdot n}\backslash \bigcup_{i< j} C_{i,j}}\] 
is the configuration space of our system. 
Its points correspond
to valid positions of the system of balls.

The evolution of the system
of balls is described by the motion of
the point $\bm{a}\in\RR^{3\cdot n}$.
It moves straight and at a
constant speed until it hits one of the cylinders $C_{i,j}$; 
this event corresponds
to a collision in the system of balls.

Consider the norm of $\bm{a}=(a_1,\dots,a_n)\in \RR^{3\cdot n}$ defined by
\[\lVert \bm{a}\rVert=\sqrt{M_1\cdot|a_1|^2+\dots+M_n\cdot |a_n|},\]
where $|a_i|=\sqrt{x_i^2+y_i^2+z_i^2}$ 
and $M_i$ denotes the mass of the $i$-th ball.
In the metric defined by $\lVert {*}\rVert$,
the collisions follow the
standard law of billiards: 
the angle of reflection is equal to the angle
of incidence. 

By construction, the number of collisions of hard balls that we need to estimate 
is the same as the number of collisions of the corresponding billiard trajectory on the table $T$ with $C_{i,j}$ as the walls.

Note that each cylinder $C_{i,j}$ is a convex set;
it has smooth boundary 
and it is centrally symmetric around the origin.
By Exercise~\ref{ex:centrally-simmetric-walls} all the intersections of the walls have $\eps$-wide corners for some $\eps>0$ that depends on the radiuses $R_i$ and the masses $M_i$.
It remains to apply Collision Theorem~\ref{thm:collision}.
\qeds

Now we present the proof of Collision Theorem (\ref{thm:collision})
based on the results developed in the previous section.

\parit{Proof of Collision Theorem (\ref{thm:collision}).}
Let us apply induction on $n$.

\parit{Base; $n=1$.}
The number of collisions cannot exceed $1$.  
Indeed, by the convexity of $A^1$,
if the trajectory is reflected once in $\partial A^1$, 
then it cannot return to $A^1$. 

\parit{Step.}
Assume $\gamma$ is a trajectory which meets the walls in the order $A^{i_1},\dots,A^{i_N}$ for a large integer $N$.

Consider the array 
\[\bm{A}_\gamma=(A^{i_1},\dots,A^{i_N}).\]
The induction hypothesis implies:

\begin{clm}{}\label{clm:collision-induction hypothesis}
There is a positive integer $M$ 
such that any $M$ 
%elements in the raw from
consecutive elements of
$\bm{A}_\gamma$ contain each $A^i$ at least once.
\end{clm}

Let $\spc{R}_\gamma $ be  the  Reshetnyak's puff pastry for  $\bm{A}_\gamma$.

Consider the lift of $\gamma$ to $\spc{R}_\gamma$
defined as 
$\bar\gamma(t)=\gamma^\kay(t)\in \spc{R}_\gamma$ 
for any moment of time $t$ between $\kay$ and $(\kay+1)$-th collisions.  
Since $\gamma$ follows  the
standard law of billiards 
at break points 
--- in particular, 
the angle of reflection is equal to the angle of incidence --- 
the lift $\bar\gamma$ is locally a geodesic in $\spc{R}_\gamma$.
Since $\spc{R}_\gamma$ is a $\Cat{}{0}$ space (see Observation~\ref{obs:puff pastry is CAT}),
$\bar\gamma$ is a geodesic.

Since $\gamma$ does not pass  through $A^1\cap\dots\cap A^n$,
the lift $\bar\gamma$ does not lie in  $\spc{R}_\gamma^0\cup \spc{R}_\gamma^N$.
In particular, $\spc{R}_\gamma$ is not end-to-end convex.

Let 
\[\bm{B}=(A^{j_1},\dots,A^{j_K})\] 
be the array provided by Proposition~\ref{prop:end-to-end-convex};
so $\bm{B}$ contains each $A^i$ at least once
and the puff pastry $\spc{R}_{\bm{B}}$ for $\bm{B}$ is end-to-end convex.
If $N$ is sufficiently large, namely $N\ge K\cdot M$, then
 \ref{clm:collision-induction hypothesis}
implies that $\bm{A}_\gamma$ can be obtained  
by inserting a finite number of $A^i$'s in $\bm{B}$.

By Observation~\ref{obs:end-to-end-convex}, 
$\spc{R}_\gamma$ is end-to-end convex,
a contradiction.
\qeds 