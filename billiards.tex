%%!TEX root = invitation-springer.tex
\chapter{Gluing theorem and billiards}\label{chapter:gluing}

In this chapter we define $\Cat{}{\kappa}$ spaces and give the first application, to billiards.

Here ``$\Cat{}{}$'' is an acronym for Cartan, Alexandrov and Toponogov.
It was coined by Mikhael Gromov in 1987.
Originally, Alexandrov called these spaces ``$\mathfrak{R}_\kappa$ domain'';
this term is still in use.

Riemannian manifolds with nonpositive sectional curvature provide a motivating example.  Specifically,  a Riemannian manifold has nonpositive sectional curvature if and only if each point admits a $\Cat{}{0}$ neighborhood.


\section{The 4-point condition}

Given a quadruple of points $p,q,x,y$ in a metric space $\spc{X}$,
consider two model triangles in the plane 
$\trig{\~p}{\~x}{\~y}=\modtrig{}(pxy)_{\EE^2}$ 
and 
$\trig{\~q}{\~x}{\~y}=\modtrig{}(qxy)_{\EE^2}$ with common side $[\~x\~y]$.

\begin{wrapfigure}{r}{31mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/CAT-pqxyz(1)}
\lbl[r]{10.5,2;$\~p$}
\lbl[l]{30,27;$\~q$}
\lbl[r]{0.5,27;$\~x$}
\lbl[l]{23,2;$\~y$}
\lbl[b]{12,16;$\~z$}
\end{lpic}
\end{wrapfigure}

If the inequality
\[\dist{p}{q}{\spc{X}}\le \dist{\~p}{\~z}{\EE^2}+\dist{\~z}{\~q}{\EE^2}\]
holds for any point $\~z\in [\~x\~y]$, then we say that 
the quadruple $p,q,x,y$ \index{$\Cat{}{0}$ comparison}\emph{satisfies $\Cat{}{0}$ comparison}.
\label{page:CAT-comparison}


If we do the same for spherical model triangles  
$\trig{\~p}{\~x}{\~y}=\modtrig{}(pxy)_{\SS^2}$ 
and 
$\trig{\~q}{\~x}{\~y}=\modtrig{}(qxy)_{\SS^2}$,
then we arrive at the definition of $\Cat{}{1}$ comparison.
If one of the spherical model triangles is undefined\footnote{ that is, if 
\[\dist{p}{x}{}+\dist{p}{y}{}+\dist{x}{y}{}\ge 2\cdot\pi
\quad
\text{or}
\quad
\dist{q}{x}{}+\dist{q}{y}{}+\dist{x}{y}{}\ge 2\cdot\pi.\]}
then it is assumed that $\Cat{}{1}$ comparison automatically holds for this quadruple.

We can do the same for the model plane of curvature $\kappa$;
that is, a sphere if $\kappa>0$, 
Euclidean plane if $\kappa=0$ 
and Lobachevsky plane if $\kappa<0$.
In this case we arrive at the definition of $\Cat{}{\kappa}$ comparison.
However in these notes we will mostly consider  $\Cat{}{0}$ comparison and occasionally $\Cat{}{1}$ comparison;
so, if you see $\Cat{}{\kappa}$, you can assume that $\kappa$ is $0$ or~$1$.


If all quadruples in a metric space $\spc{X}$ satisfy $\Cat{}{\kappa}$ comparison, then we say that the space $\spc{X}$ is $\Cat{}{\kappa}$.
(Note that $\Cat{}{\kappa}$ is an adjective.)

In order to check $\Cat{}{\kappa}$ comparison, it is sufficient to know the 6 distances between all pairs of points in the quadruple.
This observation implies the following.

\begin{thm}{Proposition}\label{prop:cat-limit}
Any Gromov--Hausdorff limit of a sequence of $\Cat{}{\kappa}$ spaces is $\Cat{}{\kappa}$. 
\end{thm}

In the proposition above, 
it does not matter which definition of convergence for metric spaces you use, 
as long as any quadruple of points in the limit space can be arbitrarily well approximated by  quadruples in the sequence of metric spaces. 

\begin{thm}{Exercise}\label{ex:cone+susp}
Let $\spc{V}$ be a metric space and $\spc{U}=\Cone\spc{V}$.
Show that $\spc{U}$ is  $\Cat{}{0}$ if and only if $\spc{V}$ is $\Cat{}{1}$.

Analogously, if $\spc{U}=\Susp\spc{V}$, then 
$\spc{U}$ is  $\Cat{}{1}$ if and only if $\spc{V}$ is $\Cat{}{1}$.
\end{thm}

The cone and suspension constructions are defined in Section~\ref{sec:constructions}.

The following exercise is bit simpler, 
but can be proved in essentially the same way.

\begin{thm}{Exercise}\label{ex:product}
Assume $\spc{U}$ and $\spc{V}$ are $\Cat{}{0}$ spaces.
Show that the product space $\spc{U}\times\spc{V}$ is $\Cat{}{0}$.
\end{thm}

\begin{thm}{Exercise}\label{ex:CAT-geodesic}
Show that any complete length $\Cat{}{0}$ space is geodesic.
\end{thm}

\section{Thin triangles} \label{sec:thin-triangle}


The inheritance lemma \ref{lem:inherit-angle} proved below plays a central role in the theory of $\Cat{}{\kappa}$ spaces.
It will lead to two fundamental constructions: 
patchwork globalization  (\ref{thm:alex-patch}) 
and Reshetnyak gluing (\ref{thm:gluing}),
which in turn are used to prove 
the globalization theorem (\ref{thm:hadamard-cartan}).

\medskip

Recall that a \index{triangle}\emph{triangle} $\trig {x^1}{x^2}{x^3}$ in a space $\spc{X}$ 
is a triple of minimizing geodesics $[x^1x^2]$, $[{x^2}{x^3}]$ and $[{x^3}{x^1}]$.
Consider the  model triangle $\trig{\~x^1}{\~x^2}{\~x^3}=\modtrig{}({x^1}{x^2}{x^3})_{\EE^2}$ in the Euclidean plane.
The  \index{natural map}\emph{natural map} $\trig{\~x^1}{\~x^2}{\~x^3}\to \trig{x^1}{x^2}{x^3}$ 
sends a point $\~z\in[\~x^i\~x^j]$ to the corresponding point $z\in[x^ix^j]$;
that is, $z$ is the point such that $\dist{\~x^i}{\~z}{}=\dist{x^i}{z}{}$ and therefore $\dist{\~x^j}{\~z}{}=\dist{x^j}{z}{}$.

In the same way, the natural map can be defined for the spherical model triangle $\modtrig{}({x^1}{x^2}{x^3})_{\SS^2}$.
 
\begin{thm}{Definition of thin triangles}\label{def:k-thin}
A triangle $\trig{x^1}{x^2}{x^3}$ in the metric space $\spc{X}$ 
is called \index{thin triangle}\emph{thin} if the natural map $\modtrig{}({x^1}{x^2}{x^3})_{\EE^2}\to \trig{x^1}{x^2}{x^3}$ is short (that is, a distance nonincreasing map).

Analogously, a triangle $\trig{x^1}{x^2}{x^3}$ 
is called \index{spherically thin}\emph{spherically thin} if
the natural map from the spherical model triangle $\modtrig{}({x^1}{x^2}{x^3})_{\SS^2}$ to $\trig{x^1}{x^2}{x^3}$ is short.
\end{thm}

\begin{thm}{Proposition}\label{prop:thin=cat}
A geodesic space is $\Cat{}{0}$ 
(or $\Cat{}{1}$) 
if and only if 
all its triangles are thin (respectively, all its triangles of perimeter $<2\cdot\pi$ are spherically thin).
\end{thm}

\parit{Proof; ``if'' part.} 
Apply  the triangle inequality and thinness of triangles $\trig pxy$ and $\trig qxy$, where $p$, $q$, $x$ and $y$ are as in the definition of $\Cat{}{\kappa}$ comparison (page \pageref{page:CAT-comparison}).

\parit{``Only-if'' part.} 
Applying $\Cat{}{0}$ comparison to a quadruple $p,q,x,y$ with $q\in [xy]$ shows that any triangle satisfies \emph{point-side comparison}, that is, the distance from a vertex to a  point on the opposite side is no greater than the corresponding distance in the Euclidean model triangle.  

Now consider a triangle $\trig{x^1}{x^2}{x^3}$ and let $y\in [x^1x^2]$ and $z\in [x^1x^3]$.
Let $\~y$, $\~z$ be the corresponding points on the sides of the model triangle $\modtrig{}({x^1}{x^2}{x^3})_{\EE^2}$.
Applying point-side comparison first to the triangle $\trig{x^1}{x^2}{x^3}$ with $y\in [x^1x^2]$, and then to the triangle $\trig{x^1}{y}{x^3}$  with $z\in [x^1x^3]$,  implies that model angles satisfy 
\[\angk {x^1} {x^2} {x^3}_{\EE^2} \ge \angk {x^1} y {x^3}_{\EE^2} \ge \angk {x^1} y z _{\EE^2}.\]
Therefore $ \dist{\~y}{\~z}{\EE^2}\ge \dist{y}{z}{}$.

The $\Cat{}{1}$ argument is the same.
\qeds

\begin{thm}{Uniqueness of geodesics}\label{thm:cat-unique}
In a proper length $\Cat{}{0}$ space, pairs of points are joined by unique geodesics, and these geodesics depend continuously on their endpoint pairs.

Analogously, in a proper length $\Cat{}{1}$ space, pairs of points at distance less than $\pi$ are joined by unique geodesics, and these geodesics depend continuously on their endpoint pairs.
\end{thm}

\parit{Proof.} 
Given 4 points $p^1,p^2,q^1,q^2$ in a proper length $\Cat{}{0}$ space $\spc{U}$, 
consider two triangles $\trig{p^1}{q^1}{p^2}$ and $\trig{p^2}{q^2}{q^1}$.
Since both of these triangles are thin, we get 
\begin{align*}
\dist{\geodpath_{[p^1q^1]}(t)}{\geodpath_{[p^2q^1]}(t)}{\spc{U}}
&\le (1-t)\cdot \dist{p^1}{p^2}{\spc{U}},
\\
\dist{\geodpath_{[p^2q^1]}(t)}{\geodpath_{[p^2q^2]}(t)}{\spc{U}}
&\le t\cdot \dist{q^1}{q^2}{\spc{U}}.
\intertext{By the triangle inequality,}
\dist{\geodpath_{[p^1q^1]}(t)}{\geodpath_{[p^2q^2]}(t)}{\spc{U}}&\le \max\{\dist{p^1}{p^2}{\spc{U}},\dist{q^1}{q^2}{\spc{U}}\}.
\end{align*}

Hence continuity and uniqueness in the $\Cat{}{0}$ case.  
 
The $\Cat{}{1}$ case is done in essentially the same way.
\qeds

Adding the first two inequalities of the preceding proof gives:

\begin{thm}{Proposition}
Suppose $p^1,p^2,q^1,q^2$ are points in a proper length $\Cat{}{0}$ space~$\spc{U}$.
Then 
\[\dist{\geodpath_{[p^1q^1]}(t)}{\geodpath_{[p^2q^2]}(t)}{\spc{U}}\]
is a convex function.
\end{thm}

\begin{thm}{Corollary}\label{cor:dist-convex}
Let $K$ be a closed convex subset in a proper length $\Cat{}{0}$ space~$\spc{U}$.
Then $\dist{K}{}{}\:\spc{U}\to\RR$ is \index{convex function}\emph{convex};
that is, the function $t\mapsto\dist{K}{}{}\circ\gamma$ is convex for any geodesic $\gamma$ in $\spc{U}$.

In particular, $\dist{p}{}{}$ is convex for any point $p$ in~$\spc{U}$.
\end{thm}


\begin{thm}{Corollary}\label{cor:contractible-cat}
Any proper length $\Cat{}{0}$ space is contractible.

Analogously, any proper length $\Cat{}{1}$ space with diameter $<\pi$ is contractible.
\end{thm}

\parit{Proof.} Let $\spc{U}$ be a proper length $\Cat{}{0}$ space.
Fix a point $p\in \spc{U}$.

For each point $x$ consider the geodesic path $\gamma_x\:[0,1]\to \spc{U}$ from $p$ to~$x$.
Consider the one parameter family of maps 
$h_t\:x\mapsto \gamma_x(t)$ for $t\in [0,1]$.
By uniqueness of geodesics (\ref{thm:cat-unique}), the map 
$(t,x)\mapsto h_t(x)$ is continuous. The family $h_t$ is called a \index{geodesic homotopy}\emph{geodesic homotopy}.

It remains to note that $h_1(x)=x$ and $h_0(x)=p$ for any~$x$.

The proof of the $\Cat{}{1}$ case is identical.
\qeds

\begin{thm}{Proposition}\label{cor:loc-geod-are-min}
Suppose $\spc{U}$ is a proper length $\Cat{}{0}$ space.  
Then any local geodesic in $\spc{U}$ is a geodesic.

Analogously, if $\spc{U}$ is a proper length $\Cat{}{1}$ space, then any local geodesic in $\spc{U}$ which is shorter than $\pi$ is a geodesic.
\end{thm}

\begin{wrapfigure}{r}{21mm}
\begin{lpic}[t(-8mm),b(0mm),r(0mm),l(0mm)]{pics/local-geod(1)}
\lbl[t]{2.5,1;$\gamma(0)$}
\lbl[b]{10,14;$\gamma(a)$}
\lbl[t]{19,8;$\gamma(b)$}
\end{lpic}
\end{wrapfigure}

\parit{Proof.}
Suppose $\gamma\:[0,\ell]\to\spc{U}$ is a local geodesic that is not a geodesic.
Choose $a$ to be the maximal value 
such that $\gamma$ is a geodesic on $[0,a]$.
Further choose $b>a$ so that $\gamma$ is a geodesic on $[a,b]$.

Since the triangle $\trig{\gamma(0)}{\gamma(a)}{\gamma(b)}$ is thin, we have
\[\dist{\gamma(a-\eps)}{\gamma(a+\eps)}{}<2\cdot\eps\]
for all small~$\eps>0$.
That is, $\gamma$ is not length-minimizing on the interval $[a-\eps,a+\eps]$ for any $\eps>0$,
a contradiction.

The spherical case is done in the same way.
\qeds


\begin{thm}{Exercise}\label{ex:geod-CBA}
Assume $\spc{U}$ is a proper length $\Cat{}{\kappa}$ space
 with extendable geodesics;
that is, any geodesic is an arc in a local geodesic $\RR\to \spc{U}$.

Show that the space of geodesic directions at any point in $\spc{U}$ is complete.

Does the statement remain true if $\spc{U}$ is complete, but not required to be proper?
\end{thm}

Now let us formulate the main result of this section.


\begin{wrapfigure}[6]{r}{28mm}
\begin{lpic}[t(-8mm),b(6mm),r(0mm),l(0mm)]{pics/lem_alex1(1)}
\lbl[lb]{10,23;$y$}
\lbl[rt]{1.5,.5;$p$}
\lbl[bl]{25,7.5;$x$}
\lbl[lb]{17,15;$z$}
\end{lpic}
\end{wrapfigure}

\begin{thm}{Inheritance lemma}
\label{lem:inherit-angle} 
Assume that a triangle $\trig p x y$ 
in a metric space is \index{decomposed triangle}\emph{decomposed} 
into two triangles $\trig p x z$ and $\trig p y z$;
that is, $\trig p x z$ and $\trig p y z$ have a common side $[p z]$, and the sides $[x z]$ and $[z y]$ together form the side $[x y]$ of $\trig p x y$.

If both triangles $\trig p x z$ and $\trig p y z$ are thin, 
then the triangle $\trig p x y$ is also thin.

Analogously, if $\trig p x y$ has perimeter $<2\cdot\pi$ and both triangles $\trig p x z$ and $\trig p y z$ are spherically thin, then triangle $\trig p x y$ is spherically thin.
\end{thm} 


\begin{wrapfigure}{r}{32mm}
\begin{lpic}[t(-8mm),b(0mm),r(0mm),l(0mm)]{pics/cat-monoton-ineq(1)}
\lbl[b]{14,23;$\dot z$}
\lbl[t]{10,.5;$\dot p$}
\lbl[r]{1,14;$\dot x$}
\lbl[l]{30.5,14;$\dot y$}
\lbl[tl]{13,13;$\dot w$}
\end{lpic}
\end{wrapfigure}

\parit{Proof.}
Construct  the model triangles $\trig{\dot p}{\dot x}{\dot z}\z=\modtrig(p x z)_{\EE^2}$ 
and $\trig {\dot p} {\dot y} {\dot z}\z=\modtrig(p y z)_{\EE^2}$ so that $\dot x$ and $\dot y$ lie on opposite sides of $[\dot p\dot z]$.

Let us show that 
\[\angk{z}{p}{x}+\angk{z}{p}{y}
\ge
\pi.
\eqlbl{eq:<+<>=pi}\]
Suppose the contrary, that is
\[\angk{z}{p}{x}+\angk{z}{p}{y}
<
\pi.\]
Then for some point $\dot w\in[\dot p\dot z]$, we have \[\dist{\dot x}{\dot w}{}+\dist{\dot w}{\dot y}{}
<
\dist{\dot x}{\dot z}{}+\dist{\dot z}{\dot y}{}=\dist{x}{y}{}.\]
Let $w\in[p z]$ correspond to $\dot w$; that is, $\dist{z}{w}{}=\dist{\dot z}{\dot w}{}$. 
Since $\trig p x z$ and $\trig p y z$ are thin, we have 
\[\dist{x}{w}{}+\dist{w}{y}{}<\dist{x}{y}{},\]
contradicting the triangle inequality. 

Denote by $\dot D$ the union of two solid triangles $\trig {\dot p}{\dot x}{\dot z}$ and $\trig {\dot p} {\dot y} {\dot z}$.
Further, denote by $\~D$ the solid triangle $\trig{\~ p}{\~ x}{\~ y}=\modtrig(p x y)_{\EE^2}$.
By \ref{eq:<+<>=pi}, there is a short map $F\:\~D\to \dot D$ that sends 
\begin{align*}
\~p&\mapsto \dot p,
&
\~x&\mapsto \dot x,
&
\~z&\mapsto \dot z,
&
\~y&\mapsto \dot y.
\end{align*}
\qedsf

\begin{thm}{Exercise}\label{ex:short-map}
Use Alexandrov's lemma (\ref{lem:alex}) to prove the last statement. 
\end{thm}


By assumption, the natural maps $\trig {\dot p} {\dot x} {\dot z}\to\trig p x z$ and $\trig {\dot p} {\dot y} {\dot z}\to\trig p y z$ are short.  
By composition,  the natural map from $\trig{\~ p}{\~ x}{\~ y}$ to $\trig p y z$ is short, as claimed.

The spherical case is done along the same lines.
\qeds

\begin{thm}{Exercise}\label{ex:convex-balls}
Show that any ball in a proper length $\Cat{}{0}$ space is a convex set.

Analogously, show that any ball of radius $R<\tfrac\pi2$ in a proper length $\Cat{}{1}$ space  is a convex set.
\end{thm}

Recall that a set $A$ in a metric space $\spc{U}$ is called locally convex if for any point $p\in A$ there is an open neighborhood $\spc{U}\ni p$ such that any geodesic in $\spc{U}$ with  ends in $A$ lies in~$A$. 

\begin{thm}{Exercise}\label{ex:locally-convex}
Let $\spc{U}$ be a proper length $\Cat{}0$ space.
Show that any closed, connected, locally convex set in $\spc{U}$ is convex.
\end{thm}

\begin{thm}{Exercise}\label{ex:closest-point}
Let  $\spc{U}$ be a proper length $\Cat{}0$ space 
and $K\subset \spc{U}$ be a closed convex set.
Show that: 

\begin{subthm}{ex:closest-point:a}
For each point $p\in \spc{U}$ there is unique point $p^*\in K$ that minimizes the distance $\dist{p}{p^*}{}$.
\end{subthm}

\begin{subthm}{}
The closest-point projection $p\mapsto p^*$ defined by (\ref{SHORT.ex:closest-point:a}) is short. 
\end{subthm}

\end{thm}


\section{Reshetnyak's gluing theorem}\label{sec:cba-gluing}

Suppose 
$\spc{U}^1$ and $\spc{U}^2$ are proper length spaces 
with isometric closed convex sets $A^i\subset\spc{U}^i$ and let $\iota\:A^1\to A^2$ be an isometry.
Consider the space $\spc{W}$ of all equivalence classes in $\spc{U}^1\sqcup\spc{U}^2$ with the equivalence relation given by $a\sim\iota(a)$ for any $a\in A^1$.

It is straightforward to see that $\spc{W}$ is a proper length space when equipped with the following metric
\begin{align*}
\dist{x}{y}{\spc{W}}&\df\dist{x}{y}{\spc{U}^i}
\\
&\quad\text{if}\quad x,y\in \spc{U}^i,\quad\text{and}
\\
\dist{x}{y}{\spc{W}}&\df\min\set{\dist{x}{a}{\spc{U}^1}+\dist{y}{\iota(a)}{\spc{U}^2}}{a\in A^1}
\\
&\quad\text{if}\quad x\in \spc{U}^1\quad\text{and}\quad y\in \spc{U}^2.
\end{align*}
Abusing notation, we denote by $x$ and $y$ the points in $\spc{U}^1\sqcup\spc{U}^2$ and their equivalence classes in $\spc{U}^1\sqcup\spc{U}^2/{{\sim}}$.

The  space $\spc{W}$ is called the \index{gluing}\emph{gluing} of $\spc{U}^1$ and  $\spc{U}^2$ along~$\iota$.
If one applies this construction to two copies of one space $\spc{U}$ with a set $A\subset \spc{U}$ and the identity map $\iota\:A\to A$, then the obtained space is called the \index{double}\emph{double} of $\spc{U}$ along~$A$.

We can (and will) identify $\spc{U}^i$ with its image in $\spc{W}$;
this way both subsets $A^i\subset \spc{U}^i$ will be identified and denoted further by~$A$.
Note that $A=\spc{U}^1\cap \spc{U}^2\subset \spc{W}$,
therefore $A$ is also a convex set in~$\spc{W}$.

The following theorem was proved by Yuri Reshetnyak in~\cite{reshetnyak:glue}.


\begin{thm}{Reshetnyak gluing}\label{thm:gluing}
Suppose 
$\spc{U}^1$ and $\spc{U}^2$ are proper length $\Cat{}{0}$ spaces 
with isometric 
closed 
 convex
sets $A^i\subset\spc{U}^i$, and $\iota\:A^1\to A^2$ is an isometry.
Then the gluing of $\spc{U}^1$ and  $\spc{U}^2$ along $\iota$ is a $\Cat{}{0}$ proper length space.
\end{thm}

\parit{Proof.} 
By construction of the gluing space, the statement can be reformulated in the following way:

{
\begin{wrapfigure}{r}{33mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/resh-glue(1)}
\lbl[b]{13,26;$x^0$}
\lbl[t]{4,3;$x^1$}
\lbl[t]{23,3;$x^2$}
\lbl[bl]{9.3,14.3;$z^1$}
\lbl[tr]{18,11;$z^2$}
\lbl{29,25;$\spc{U}^1$}
\lbl{29,5;$\spc{U}^2$}
\lbl{22,14;{\color{white}$A$}}
\end{lpic}
\end{wrapfigure}

\begin{thm}{Reformulation of \ref{thm:gluing}}
Let $\spc{W}$ be a 
proper length space which has two closed 
convex sets $\spc{U}^1,\spc{U}^2\subset\spc{W}$ such that 
$\spc{U}^1\cup\spc{U}^2=\spc{W}$
and $\spc{U}^1$, $\spc{U}^2$ are $\Cat{}{0}$.
Then $\spc{W}$ is $\Cat{}{0}$.
\end{thm}

It suffices to show that any triangle $\trig {x^0}{x^1}{x^2}$ 
in $\spc{W}$ is thin.
This is obviously true if all three points $x^0$, $x^1$, $x^2$ lie in one of~$\spc{U}^i$.
Thus, without loss of generality, we may assume that $x^0\in\spc{U}^1$ and $x^1,x^2\in\spc{U}^2$.

}

Choose points $z^1,z^2\in A=\spc{U}^1\cap\spc{U}^2$ 
that lie respectively on the sides $[x^0x^1], [x^0x^2]$.
Note that

\begin{itemize}
\item the triangle $\trig{x^0}{z^1}{z^2}$ lies in $\spc{U}^1$,
\item both triangles $\trig{x^1}{z^1}{z^2}$ and $\trig{x^1}{z^2}{x^2}$ lie in~$\spc{U}^2$.
\end{itemize}
In particular each triangle $\trig{x^0}{z^1}{z^2}$,
$\trig{x^1}{z^1}{z^2}$ and $\trig{x^1}{z^2}{x^2}$ is thin.

Applying the inheritance lemma for thin triangles (\ref{lem:inherit-angle}) twice 
we get that $\trig {x^0}{x^1}{z^2}$ 
and consequently $\trig {x^0}{x^1}{x^2}$ is thin.
\qeds

\section{Reshetnyak puff pastry}\label{sec:puff-pastry}

In this section we introduce 
the notion of 
Reshetnyak puff pastry.  This  construction will be used in the next section to prove the collision theorem (\ref{thm:collision}).

Let $\bm{A}=(A^1,\dots,A^N)$ be an array of convex closed sets in the Euclidean space~$\EE^m$.
Consider an array of $N+1$ copies of~$\EE^m$.
Assume that the space $\spc{R}$ is 
obtained by
gluing successive pairs of spaces along  $A^1,\dots,A^N$ respectively.

\begin{wrapfigure}{r}{58mm}
\begin{lpic}[t(0mm),b(4mm),r(0mm),l(0mm)]{pics/puff-pastry-example(1)}
\lbl[b]{18,24;$A$}
\lbl[b]{38,24;$B$}
\lbl[w]{53,2,-11;$\spc{R}^0$}
\lbl[w]{53,8,-11;$\spc{R}^1$}
\lbl[w]{53,12,11;$\spc{R}^2$}
\lbl[w]{53,18,11;$\spc{R}^3$}
\lbl[b]{28,-4;Puff pastry for $(A,B,A)$.}
\end{lpic}
\end{wrapfigure}

The resulting space $\spc{R}$  will be called 
the
\index{puff pastry}\emph{Reshetnyak puff pastry} for the array~$\bm{A}$.
The copies of $\EE^m$ in the puff pastry $\spc{R}$
will be called {}\emph{levels};
they will be denoted by $\spc{R}^0,\dots,\spc{R}^N$.
The point in the $\kay$-th level $\spc{R}^\kay$
that corresponds to $x\in \EE^m$
will be denoted by~$x^\kay$.

Given $x\in \EE^m$, any point $x^\kay\in\spc{R}$ is called a {}\emph{lifting} of~$x$.
The map $x\mapsto x^\kay$ defines an isometry $\EE^m\to \spc{R}^\kay$;  
in particular we can talk about liftings of subsets in~$\EE^m$.

Note that: 
\begin{itemize}
\item The intersection $A^1\cap\dots\cap A^N$ admits a unique lifting in~$\spc{R}$.
\item Moreover, $x^i=x^j$ for some $i<j$
if and only if 
\[x\in A^{i+1}\cap\dots\cap A^j.\]
\item The restriction $\spc{R}^\kay\to \EE^m$
of the natural projection $x^\kay\mapsto x$ is an isometry.
\end{itemize}




\begin{thm}{Observation}\label{obs:puff pastry is CAT}
Any Reshetnyak puff pastry is a proper length $\Cat{}{0}$ space.
\end{thm}

\parit{Proof.} Apply Reshetnyak gluing theorem (\ref{thm:gluing}) recursively for the convex sets in the array.
\qeds

\begin{thm}{Proposition}\label{prop:A-check-A}
Assume $(A^1,\dots,A^N)$ and $(\check A^1,\dots,\check A^N)$ are two arrays of convex closed sets in $\EE^m$ 
such that $ A^\kay\subset \check A^\kay$ for each~$\kay$.
Let $\spc{R}$ and $\check{\spc{R}}$ be the corresponding Reshetnyak  puff pastries.
Then the map $\spc{R}\to\check{\spc{R}}$
defined by $x^\kay\mapsto\check x^\kay$ is short.

Moreover, if  
\[\dist{x^i}{y^j}{\spc{R}}=\dist{\check x^i}{\check y^j}{\check{\spc{R}}}\eqlbl{eq:dist=dist}\]
for some $x,y\in \EE^m$ and $i,j\in \{0,\dots,n\}$,
then the unique geodesic $[\check x^i \check y^j]_{\check{\spc{R}}}$ 
is the image of the unique geodesic $[x^i y^j]_{\spc{R}}$
under the map $x^i\mapsto \check x^i$.
\end{thm}

\parit{Proof.}
The first statement in the proposition 
follows from the construction of Reshetnyak  puff pastries.

By Observation~\ref{obs:puff pastry is CAT}, 
$\spc{R}$  and  $\check{\spc{R}}$ are $\Cat{}{0}$ proper length spaces, 
hence $[x^i y^j]_{\spc{R}}$ 
and $[\check x^i \check y^j]_{\check{\spc{R}}}$ are unique.  
By \ref{eq:dist=dist}, since the map $\spc{R}\to\check{\spc{R}}$ is short, 
the image of $[x^i y^j]_{\spc{R}}$
is a geodesic of $\check{\spc{R}}$ joining $\check x^i$ to~$\check y^j$.
Hence the second statement follows.
\qeds

\begin{thm}{Definition}
Consider a Reshetnyak puff pastry $\spc{R}$ with the levels 
$\spc{R}^0,\dots,\spc{R}^N$.
We say that $\spc{R}$ is \index{end-to-end convex}\emph{end-to-end convex} 
if $\spc{R}^0\cup\spc{R}^N$, the union of its lower and upper levels, 
forms a convex set in~$\spc{R}$.
\end{thm}

Note that if $\spc{R}$ is the Reshetnyak puff pastry for an array of convex sets $\bm{A}=(A^{1},\dots, A^{N})$, 
then $\spc{R}$ is end-to-end convex
if and only if the union of the lower and the upper levels
$\spc{R}^0\cup\spc{R}^N$ is isometric to the double of $\EE^m$ along the nonempty intersection $A^1\cap\dots\cap A^N$.


\begin{thm}{Observation}\label{obs:end-to-end-convex}
Let $\check{\bm{A}}$ and $\bm{A}$ be arrays of convex bodies in~$\EE^m$.
Assume 
the  array $\bm{A}$ is
obtained by inserting in $\check{\bm{A}}$ 
several copies of the bodies which were already listed in~$\check{\bm{A}}$.

For example, if $\check{\bm{A}}=(A,C,B,C,A)$, by placing $B$ in the second place and $A$ in the fourth place, we obtain $\bm{A}=(A,B,C,A,B,C,A)$.

Denote by $\check{\spc{R}}$ and $\spc{R}$ 
the Reshetnyak puff pastries for $\check{\bm{A}}$ and $\bm{A}$ respectively.

If $\check{\spc{R}}$ is end-to-end convex, then so is~$\spc{R}$.
\end{thm}

\parit{Proof.}
Without loss of generality we may assume that $\bm{A}$ is 
obtained by inserting one element in $\check{\bm{A}}$,
say at the place number~$\kay$.

Note that $\check{\spc{R}}$ is isometric to the puff pastry 
for $\bm{A}$ with $A^\kay$ replaced by~$\EE^m$.
It remains to apply Proposition~\ref{prop:A-check-A}.
\qeds

\begin{wrapfigure}[7]{r}{32mm}
\begin{lpic}[t(-0mm),b(0mm),r(0mm),l(0mm)]{pics/dihedral-angle(1)}
\lbl[t]{2,5;$p$}
\lbl{22,12;{\color{white}$X$}}
\lbl{27,23;$D$}
\end{lpic}
\end{wrapfigure}

Let $X$ be a convex set in a Euclidean space.
By a \index{dihedral angle}\emph{dihedral angle} we understand an intersection of two half-spaces;
the intersection of corresponding hyperplanes is called the {}\emph{edge} of the angle.
We say that a dihedral angle $D$ 
supports
 $X$ at a point $p\in X$ 
if $D$ contains $X$ and the edge of $D$ contains~$p$.

\begin{thm}{Lemma}\label{lem:end-to-end-convex}
Let $A$ and $B$ be two convex sets in~$\EE^m$.
Assume that any dihedral angle supporting $A\cap B$ at some point has angle measure at least~$\alpha$.
Then the Reshetnyak puff pastry for the array
\[(\underbrace{A,B,A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}}).\]
is end-to-end convex. 
\end{thm}


The proof of the lemma is based on a partial case,
which we formulate as a sublemma.

\begin{thm}{Sublemma}\label{sublem:end-to-end-convex}
Let $\ddot A$ and $\ddot B$ be two  
half-planes in $\EE^2$, where $\ddot A\cap \ddot B$ is an angle with measure~$\alpha$.
Then the Reshetnyak puff pastry for the array \[(\underbrace{\ddot A,\ddot B,\ddot A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}})\]
is end-to-end convex. 
\end{thm}

\begin{wrapfigure}{r}{52mm}
\begin{lpic}[t(-6mm),b(0mm),r(0mm),l(0mm)]{pics/puff-pastry(1)}
\lbl[t]{23,33,6;$\alpha$}
\lbl[b]{20,47,6;$\alpha$}
\lbl[b]{30,3,6;$\alpha$}
\lbl[b]{12.5,13,-71;$\pi-\alpha$}
\lbl[t]{41,23,-71;$\pi-\alpha$}
\end{lpic}
\end{wrapfigure}

\parit{Proof.}
Note that the puff pastry $\ddot{\spc{R}}$ is isometric to the cone over the space glued from the unit circles as shown on the diagram.

All the short arcs on the diagram have length $\alpha$;
the long arcs have length $\pi-\alpha$,
so making a circuit along any path will take~$2\cdot\pi$.

Observe that end-to-end convexity of $\ddot{\spc{R}}$
is equivalent to the fact that any geodesic shorter than $\pi$ with the ends on the inner and the outer circles lies completely in the union of these two circles.

The latter holds if the zigzag line has length at least $\pi$.
This line is formed by $\lceil\tfrac\pi\alpha\rceil$ arcs with length $\alpha$ each.
Hence the sublemma.
\qeds

{

\begin{wrapfigure}{r}{35mm}
\begin{lpic}[t(-0mm),b(0mm),r(0mm),l(0mm)]{pics/AB-xyz(1)}
\lbl[br]{13,35;$x$}
\lbl[bl]{25,37;$y$}
\lbl[t]{17.7,22.5;{\color{white}$z_0$}}
\lbl{8,22;{\color{white}$A$}}
\lbl[t]{25,23;{\color{white}$B$}}
\lbl[t]{3,33;$\dot A$}
\lbl[t]{31,29;$\dot B$}
\end{lpic}
\end{wrapfigure}

In the proof of \ref{lem:end-to-end-convex}, we will use the following exercise in convex geometry:

\begin{thm}{Exercise}\label{ex:supporting-planes}
Let $A$ and $B$ be two closed convex sets in $\EE^m$ and $A\cap B\ne\emptyset$.
Given two points $x,y\in \EE^m$  let $f(z)=\dist{x}{z}{}+\dist{y}{z}{}$.

Let $z_0\in A\cap B$ be  a point of minimum of $f|_{A\cap B}$.

Show that there are half-spaces $\dot A$ and $\dot B$ such that
$\dot A\supset A$ and $\dot B\supset B$
and $z_0$ is also a point of minimum of the restriction $f|_{\dot A\cap \dot B}$.

\end{thm}

}

\parit{Proof of \ref{lem:end-to-end-convex}.}
Fix arbitrary $x,y\in \EE^m$.
Choose a point $z\in A\cap B$
for which the sum 
\[\dist{x}{z}{}+\dist{y}{z}{}\] 
is minimal.
To show the end-to-end convexity of  $\spc{R}$,
it is sufficient to prove the following:

\begin{clm}{}\label{clm:z in xy}
The geodesic $[x^0y^N]_\spc{R}$ contains $z^0=z^N\in \spc{R}$.
\end{clm}

Without loss of generality we may assume that $z\in\partial A\cap\partial B$.
Indeed, since the puff pastry for the 1-array $(B)$ is end-to-end convex,
Proposition~\ref{prop:A-check-A} together with Observation~\ref{obs:end-to-end-convex}
imply \ref{clm:z in xy} in  case $z$ lies in the interior of~$A$.
In the same way we can treat the case when $z$ lies in the interior of~$B$.

Note that $\EE^{m}$ admits 
an
isometric splitting $\EE^{m-2}\times \EE^2$ 
such that 
\begin{align*}
\dot A&=\EE^{m-2}\times \ddot A
\\
\dot B&=\EE^{m-2}\times \ddot B
\end{align*}
where $\ddot A$ and $\ddot B$ are half-planes in~$\EE^2$.

Using Exercise \ref{ex:supporting-planes}, let us replace each $A$ by $\dot A$ and each $B$ by $\dot B$
in the array, to get the array
\[(\underbrace{\dot A,\dot B,\dot A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}}).\]
The corresponding puff pastry $\dot{\spc{R}}$
splits as a product of $\EE^{m-2}$ and a puff pastry, 
call it $\ddot{\spc{R}}$,
glued from the copies of the plane $\EE^2$ for the array
\[(\underbrace{\ddot A,\ddot B,\ddot A,\dots}_{\text{$\lceil\tfrac\pi\alpha\rceil+1$ times}}).\]

Note that the dihedral angle $\dot A\cap \dot B$ is at least~$\alpha$.
Therefore the angle measure of  $\ddot A\cap \ddot B$ is also at least $\alpha$.
According to Sublemma~\ref{sublem:end-to-end-convex} and Observation~\ref{obs:end-to-end-convex}, $\ddot{\spc{R}}$ is end-to-end convex.

Since $\dot{\spc{R}}\iso\EE^{m-2}\times\ddot{\spc{R}}$, 
the puff pastry $\dot{\spc{R}}$ is also end-to-end convex.

It follows that the geodesic $[\dot x^0\dot y^N]_{\dot{\spc{R}}}$ contains $\dot z^0=\dot z^N\in\dot{\spc{R}}$.
By Proposition~\ref{prop:A-check-A}, 
the image of $[\dot x^0\dot y^N]_{\dot{\spc{R}}}$ 
under the map $\dot x^\kay\mapsto x^\kay$
is the geodesic $[x^0 y^N]_{\spc{R}}$.
Hence Claim~\ref{clm:z in xy}, 
and the lemma follow.
\qeds

\section{Wide corners}

We say that a closed convex set $A\subset \EE^m$ has  \index{$\eps$-wide corners}\emph{$\eps$-wide corners}\label{page:wide corners} for given $\epsilon >0$ 
if together with each point $p$, 
the set $A$ contains a small right circular cone
with tip at $p$ and aperture $\eps$;
that is, $\eps$ is the maximum angle between two generating lines of the cone.

For example, 
a plane polygon 
has $\eps$-wide corners
if all its interior angles are at least~$\eps$.

We will consider finite collections of closed convex sets 
$A^1,\dots,A^n\subset\EE^m$ 
such that for any subset $F\subset\{1,\dots,n\}$,
the intersection
$\bigcap_{i\in F}A^i$ 
has $\eps$-wide corners.
In this case we may say briefly \index{$\eps$-wide corners}\emph{all intersections of $A^i$ have $\eps$-wide corners}.


\begin{thm}{Exercise}\label{ex:compact-walls}
Assume $A^1,\dots,A^n\subset\EE^m$ are compact, convex sets with a common interior point.
Show that all intersections of $A^i$ have $\eps$-wide corners for some positive~$\eps$.
\end{thm}

\begin{thm}{Exercise}\label{ex:centrally-simmetric-walls}
Assume $A^1,\dots,A^n\subset\EE^m$ are
convex sets with nonempty interior that have a common center of symmetry.
Show that all intersections of $A^i$ have $\eps$-wide corners for some positive~$\eps$.
\end{thm}

The proof of the following proposition is based on Lemma~\ref{lem:end-to-end-convex};
this lemma is essentially the case $n=2$ in the proposition.

\begin{thm}{Proposition}\label{prop:end-to-end-convex}
Given $\eps>0$ and a positive integer $n$, 
there is an array of integers $\bm{j}_\eps(n)=(j_1,\dots,j_N)$ 
such that: 

\begin{subthm}{} For each $\kay$ we have $1\le j_\kay\le n$,
and each number $1,\dots,n$ appears in $\bm{j}_\eps$ at least once.
\end{subthm}

\begin{subthm}{}
If $A^1,\dots,A^n$ is a collection of closed convex sets in $\EE^m$ with a common point 
and all their intersections have $\eps$-wide corners,  
then the puff pastry for the array
$(A^{j_1},\dots,A^{j_N})$ is end-to-end convex.
\end{subthm}

Moreover we can assume that $N\le (\lceil\tfrac\pi\eps\rceil+1)^n$.
\end{thm}

\parit{Proof.}
The array $\bm{j}_\eps(n)=(j_1,\dots,j_N)$  is constructed recursively.
For $n=1$, we can take $\bm{j}_\eps(1)=(1)$.

Assume that $\bm{j}_\eps(n)$ is constructed.
Let us replace each occurrence of $n$ in $\bm{j}_\eps(n)$ by the alternating string 
\[\underbrace{n,n+1,n,\dots}_{\text{$\lceil\tfrac\pi\eps\rceil+1$ times}}.\]
Denote the obtained array by $\bm{j}_\eps(n+1)$.

By Lemma \ref{lem:end-to-end-convex},
end-to-end convexity of the puff pastry for $\bm{j}_\eps(n\z+1)$
follows from end-to-end convexity of the puff pastry for the array
where each string
\[\underbrace{A^n,A^{n+1},A^n,\dots}_{\text{$\lceil\tfrac\pi\eps\rceil+1$ times}}\]
is replaced by  $Q=A^n\cap A^{n+1}$.
End-to-end convexity of the latter follows by the assumption on $\bm{j}_\eps(n)$, 
since all the intersections of $A^1,\dots,A^{n-1},Q$
have $\eps$-wide corners.

The upper bound on $N$ follows directly from the construction.
\qeds



\section{Billiards}

Let $A^1,A^2,\dots A^n$ be a finite collection of closed convex sets in~$\EE^m$.
Assume that for each $i$
the boundary $\partial A^i$ is a smooth hypersurface.

\begin{center}
\begin{lpic}[t(-0mm),b(0mm),r(0mm),l(0mm)]{pics/billiards(1)}
\lbl{19,27;{\color{white}$A_1$}}
\lbl{35,32;{\color{white}$A_2$}}
\lbl{42,21.6;{\color{white}$A_3$}}
\end{lpic}
\end{center}

Consider the billiard table formed by the closure of the complement 
$$T=\overline{\EE^m\backslash \bigcup_{i} A^i}.$$
The sets $A^i$ will be called {}\emph{walls} of the table $T$ 
and the billiards described above will be called {}\emph{billiards with convex walls}.

A {}\emph{billiard trajectory} 
on the table $T$ is a unit-speed broken line $\gamma$ 
that  follows  the
standard law of billiards 
at the break points on $\partial A^i$ 
--- in particular, the angle of reflection is equal to the angle of incidence.
The break points of the trajectory will be called {}\emph{collisions}.
We assume the trajectory meets only one wall at a time.

Recall that the definition of sets with $\eps$-wide corners is given on page \pageref{page:wide corners}.

\begin{thm}{Collision theorem}\label{thm:collision}
Assume $T\subset\EE^m$ is a billiard table with $n$ convex walls.
Assume that the walls of $T$ have a common interior point  and all their intersections have $\eps$-wide corners.
Then the number of collisions of any trajectory in  $T$  is bounded
by a number $N$ which depends only on $n$ and~$\eps$.
\end{thm}

As we will see from the proof,
the value $N$ can be found explicitly;
\[N=(\lceil\tfrac\pi\eps\rceil+1)^{n^2}\]
will do.

The collision theorem was proved by Dmitri Burago, Serge Ferleger and Alexey Kononenko in \cite{BFK};
we present their proof with minor improvements.

Let us formulate and prove a corollary of the  collision theorem:

\begin{thm}{Corollary}\label{cor:balls}
Consider $n$ homogeneous hard balls
moving freely and colliding
elastically in~$\RR^3$. 
Every ball moves
along a straight line with constant speed until two balls collide, and then
the new velocities of the two balls are determined by the
laws of classical mechanics. 
We assume that only two balls can collide at the same time.

Then the total number of collisions cannot exceed some number $N$ that  depends on the radii and masses of the balls.
If the balls are identical, then $N$ depends only on~$n$.
\end{thm}


The proof below admits a straightforward generalization to all dimensions.

\parit{Proof.}
Denote by $a_i=(x_i,y_i,z_i) \in \RR^3$ the center of the $i$-th ball.
Consider the corresponding point in $\RR^{3\cdot N}$
\begin{align*}
\bm{a}&=(a_1, a_2 , \dots , a_n ) =
\\
&=(x_1, y_1 , z_1 , x_2 , y_2 , z_2 , \dots , x_n , y_n , z_n).
\end{align*}

The $i$-th and $j$-th ball intersect if 
$$|a_i - a_j | \le R_i+R_j,$$
where $R_i$ denotes the radius of the $i$-th ball.
These inequalities define $\tfrac{n\cdot(n-1)}{2}$ cylinders 
\[C_{i,j}=\set{(a_1, a_2 , \dots , a_n )\in\RR^{3\cdot n}} {|a_i - a_j |\le R_i+R_j}.\] 
The closure of the complement
\[T=\overline{\RR^{3\cdot n}\backslash \bigcup_{i< j} C_{i,j}}\] 
is the configuration space of our system. 
Its points correspond
to valid positions of the system of balls.

The evolution of the system
of balls is described by the motion of
the point $\bm{a}\in\RR^{3\cdot n}$.
It moves along a straight line at a
constant speed until it hits one of the cylinders $C_{i,j}$; 
this event corresponds
to a collision in the system of balls.

Consider the norm of $\bm{a}=(a_1,\dots,a_n)\in \RR^{3\cdot n}$ defined by
\[\lVert \bm{a}\rVert
=
\sqrt{M_1\cdot|a_1|^2+\dots+M_n\cdot |a_n|},\]
where $|a_i|=\sqrt{x_i^2+y_i^2+z_i^2}$ 
and $M_i$ denotes the mass of the $i$-th ball.
In the metric defined by $\lVert {*}\rVert$,
the collisions follow the
standard law of billiards. 

By construction, the number of collisions of hard balls that we need to estimate 
is the same as the number of collisions of the corresponding billiard trajectory on the table $T$ with $C_{i,j}$ as the walls.

Note that each cylinder $C_{i,j}$ is a convex set;
it has smooth boundary 
and it is centrally symmetric around the origin.
By Exercise~\ref{ex:centrally-simmetric-walls}, all the intersections of the walls have $\eps$-wide corners for some $\eps>0$ that depends on the radiuses $R_i$ and the masses~$M_i$.
It remains to apply the collision theorem (\ref{thm:collision}).
\qeds

Now we present the proof of the collision theorem (\ref{thm:collision})
based on the results developed in the previous section.

\parit{Proof of \ref{thm:collision}.}
Let us apply induction on~$n$.

\parit{Base: $n=1$.}
The number of collisions cannot exceed~1.  
Indeed, by the convexity of $A^1$,
if the trajectory is reflected once in $\partial A^1$, 
then it cannot return to~$A^1$. 

\parit{Step.}
Assume $\gamma$ is a trajectory that  meets the walls in the order $A^{i_1},\dots,A^{i_N}$ for a large integer~$N$.

Consider the array 
\[\bm{A}_\gamma=(A^{i_1},\dots,A^{i_N}).\]
The induction hypothesis implies:

\begin{clm}{}\label{clm:collision-induction hypothesis}
There is a positive integer $M$ such that any $M$ consecutive elements of $\bm{A}_\gamma$ contain each $A^i$ at least once.
\end{clm}

Let $\spc{R}_\gamma $ be  the  Reshetnyak puff pastry for~$\bm{A}_\gamma$.

Consider the lift of $\gamma$ to $\spc{R}_\gamma$,
defined by 
$\bar\gamma(t)=\gamma^\kay(t)\in \spc{R}_\gamma$ 
for any moment of time $t$ between the $\kay$-th and $(\kay+1)$-th collisions.  
Since $\gamma$ follows  the standard law of billiards at break points, the lift $\bar\gamma$ is locally a geodesic in~$\spc{R}_\gamma$.
By Observation~\ref{obs:puff pastry is CAT},
the puff pastry $\spc{R}_\gamma$ is a proper length $\Cat{}{0}$ space.
Therefore $\bar\gamma$ is a geodesic.

Since $\gamma$ does not meet $A^1\cap\dots\cap A^n$,
the lift $\bar\gamma$ does not lie in  $\spc{R}_\gamma^0\cup \spc{R}_\gamma^N$.
In particular, $\spc{R}_\gamma$ is not end-to-end convex.

Let 
\[\bm{B}=(A^{j_1},\dots,A^{j_K})\] 
be the array provided by Proposition~\ref{prop:end-to-end-convex};
so $\bm{B}$ contains each $A^i$ at least once
and the puff pastry $\spc{R}_{\bm{B}}$ for $\bm{B}$ is end-to-end convex.
If $N$ is sufficiently large, namely $N\ge K\cdot M$, then
 \ref{clm:collision-induction hypothesis}
implies that $\bm{A}_\gamma$ can be obtained  
by inserting a finite number of $A^i$'s in~$\bm{B}$.

By Obser
vation~\ref{obs:end-to-end-convex}, 
$\spc{R}_\gamma$ is end-to-end convex,
a contradiction.
\qeds

\section{Comments}

The gluing theorem (\ref{thm:gluing}) extends to the class of geodesic $\Cat{}{0}$ spaces, 
which by Exercise~\ref{ex:CAT-geodesic} includes all complete length $\Cat{}{0}$ spaces.
It also admits a natural generalization to 
length $\Cat{}{\kappa}$
spaces;
see the book of Martin Bridson and  Andr\'e Haefliger \cite{BH} and our book \cite{AKP} for details.

The puff pastry is used to bound topological entropy of the billiard flow 
and to approximate the shortest path that touches given lines in given order; 
see another paper of Dmitri Burago, Serge Ferleger and Alexey Kononenko~\cite{BFK-2}
and the paper of Dmitri Burago, Dimitri Grigoriev and Anatol Slissenko~\cite{BGS}.
The lecture \cite{burago-icm} gives a short survey on the subject.

Note that the interior points of the walls play a key role in the proof
despite the fact that trajectories never go inside the walls.
In a similar fashion, puff pastry was used by the first author and Richard Bishop in \cite{a-b:warped}
to find the upper curvature bound for warped products.

In \cite{hass},
Joel Hass constructed an example of a Riemannian metric on the 3-ball with negative curvature and concave boundary.
This example might decrease your appetite for generalizing the collision theorem --- while
locally such a 3-ball looks as good as the billiards table in the theorem, the number of collisions is obviously infinite.



